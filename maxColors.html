<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ é»åœŸæ··è‰²éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #FFE5B4, #FFCCCB, #E0E6FF);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.1'%3E%3Ctext x='10' y='30' font-size='20' fill='%23FF6B6B'%3EğŸ¨%3C/text%3E%3Ctext x='70' y='20' font-size='15' fill='%234ECDC4'%3EğŸŒˆ%3C/text%3E%3Ctext x='20' y='70' font-size='18' fill='%23FFE66D'%3Eâœ¨%3C/text%3E%3Ctext x='80' y='80' font-size='16' fill='%23FF6B6B'%3EğŸ­%3C/text%3E%3Ctext x='50' y='50' font-size='14' fill='%234ECDC4'%3EğŸ–Œï¸%3C/text%3E%3C/g%3E%3C/svg%3E");
            background-repeat: repeat;
            pointer-events: none;
            z-index: -1;
            opacity: 0.3;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .start-screen, .end-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .game-title {
            font-size: 3rem;
            color: #FF6B6B;
            margin-bottom: 30px;
            text-shadow: 3px 3px 0px #FFE66D;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }



        .start-btn, .restart-btn {
            font-size: 1.5rem;
            padding: 15px 30px;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .start-btn:hover, .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.3);
        }

        .game-screen {
            display: none;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            height: 100vh;
            padding: 20px 0;
        }

        .color-selection {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .color-selection::after {
            content: 'ğŸ¨';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            opacity: 0.15;
            animation: spin 8s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .section-title {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .color-balls {
            display: grid;
            gap: 15px;
            justify-items: center;
        }

        .color-balls.children {
            grid-template-columns: repeat(2, 1fr);
        }

        .color-balls.advanced {
            grid-template-columns: repeat(3, 1fr);
        }

        .color-ball {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 4px solid white;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
        }

        .color-ball:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .color-ball:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        .mixing-area {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .mixing-area::before {
            content: 'ğŸ¨âœ¨ğŸŒˆğŸ­ğŸ–Œï¸';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 12px;
            opacity: 0.2;
            letter-spacing: 5px;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .target-color {
            text-align: center;
        }

        .target-display {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            margin: 10px auto;
            border: 5px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        .color-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .mixing-zone {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .drop-zone {
            width: 100px;
            height: 100px;
            border: 3px dashed #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.5);
            transition: all 0.3s ease;
            position: relative;
        }

        .drop-zone.drag-over {
            border-color: #4ECDC4;
            background: rgba(78, 205, 196, 0.2);
            transform: scale(1.1);
        }

        .plus-sign {
            font-size: 2rem;
            color: #666;
            font-weight: bold;
        }

        .result-display {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            border: 5px solid #333;
            background: #f0f0f0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .check-btn {
            padding: 12px 25px;
            font-size: 1.2rem;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .check-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .info-panel {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .info-panel::before {
            content: 'â­ğŸ®ğŸ†';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 14px;
            opacity: 0.1;
            animation: twinkle 4s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.1); }
        }

        .info-item {
            margin-bottom: 20px;
            text-align: center;
        }

        .info-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-top: 5px;
        }

        .timer {
            color: #FF6B6B;
        }

        .score {
            color: #4ECDC4;
        }

        .level {
            color: #FFE66D;
        }

        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            padding: 20px 40px;
            border-radius: 20px;
            z-index: 1000;
            animation: feedbackPop 1s ease-out;
        }

        .feedback.correct {
            background: #4ECDC4;
            color: white;
        }

        .feedback.incorrect {
            background: #FF6B6B;
            color: white;
        }

        @keyframes feedbackPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }



        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            width: 0%;
            transition: width 0.5s ease;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: #666;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
        }

        .back-btn:hover {
            background: #555;
        }

        .final-stats {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.2rem;
        }

        .color-theory-tips {
            background: rgba(255, 248, 220, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid rgba(255, 230, 109, 0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            animation: tipGlow 3s ease-in-out infinite alternate;
        }

        .tip-toggle-btn {
            background: rgba(255, 230, 109, 0.3);
            border: 2px solid rgba(255, 230, 109, 0.5);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tip-toggle-btn:hover {
            background: rgba(255, 230, 109, 0.5);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .tip-toggle-btn:active {
            transform: scale(0.95);
        }

        .tip-content.hidden {
            display: none;
        }

        @keyframes tipGlow {
            0% { box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
            100% { box-shadow: 0 4px 20px rgba(255, 230, 109, 0.3); }
        }

        .tip-content {
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .game-screen {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 15px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .color-ball {
                width: 60px;
                height: 60px;
            }
            
            .target-display, .result-display {
                width: 100px;
                height: 100px;
            }

            .color-theory-tips {
                margin-top: 15px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- é–‹å§‹ç•«é¢ -->
        <div class="start-screen" id="startScreen">
            <h1 class="game-title">ğŸ¨ é»åœŸæ··è‰²éŠæˆ²</h1>
            <p style="font-size: 1.2rem; margin-bottom: 30px; color: #666;">æ··åˆé¡è‰²ï¼Œå‰µé€ ç›®æ¨™è‰²å½©ï¼é©åˆæ‰€æœ‰å¹´é½¡çš„æœ‰è¶£é«”é©—</p>
            <button class="start-btn" onclick="startGame()">ğŸ® éŠæˆ²é–‹å§‹</button>
        </div>

        <!-- éŠæˆ²ç•«é¢ -->
        <div class="game-screen" id="gameScreen">
            <!-- å·¦å´ï¼šé¡è‰²é¸æ“‡å€ -->
            <div class="color-selection">
                <h3 class="section-title">ğŸ¨ é¡è‰²å°çƒ</h3>
                <div class="color-balls" id="colorBalls"></div>
            </div>

            <!-- ä¸­é–“ï¼šæ··è‰²æ“ä½œå€ -->
            <div class="mixing-area">
                <div class="target-color">
                    <h3>ğŸ¯ ç›®æ¨™é¡è‰²</h3>
                    <div class="target-display" id="targetDisplay"></div>
                    <div class="color-info" id="colorInfo"></div>
                    <div class="hint-display" id="hintDisplay" style="display: none; margin-top: 10px; padding: 10px; background: rgba(255, 235, 59, 0.2); border-radius: 10px; font-size: 0.9rem; color: #666;">
                        ğŸ’¡ æç¤ºï¼šè©¦è©¦çœ‹é€™äº›é¡è‰²çµ„åˆï¼
                    </div>
                </div>

                <div class="mixing-zone">
                    <div class="drop-zone" id="dropZone1">
                        <span class="plus-sign">+</span>
                    </div>
                    <div class="plus-sign">â•</div>
                    <div class="drop-zone" id="dropZone2">
                        <span class="plus-sign">+</span>
                    </div>
                    <div class="drop-zone" id="dropZone3" style="display: none;">
                        <span class="plus-sign">+</span>
                    </div>
                    <div class="plus-sign" id="thirdPlus" style="display: none;">â•</div>
                    <div class="plus-sign">=</div>
                    <div class="result-display" id="resultDisplay"></div>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="check-btn" onclick="checkAnswer()">ğŸŒˆ æª¢æŸ¥ç­”æ¡ˆ</button>
                    <button class="check-btn" onclick="clearColors()" style="background: linear-gradient(45deg, #FF6B6B, #FFA500);">ğŸ—‘ï¸ æ¸…é™¤é¡è‰²</button>
                </div>
            </div>

            <!-- å³å´ï¼šæŒ‘æˆ°è³‡è¨Šå€ -->
            <div class="info-panel">
                <div class="info-item">
                    <div>â³ æ™‚é–“</div>
                    <div class="info-value timer" id="timer">60</div>
                </div>
                <div class="info-item">
                    <div>â­ åˆ†æ•¸</div>
                    <div class="info-value score" id="score">0</div>
                </div>
                <div class="info-item">
                    <div>ğŸ® é—œå¡</div>
                    <div class="info-value level" id="level">1</div>
                </div>
                <div class="info-item">
                    <div>ğŸ¯ é€²åº¦</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.9rem;" id="progressText">0/3</div>
                </div>
                
                <!-- è‰²å½©å­¸æç¤ºå€ -->
                <div class="color-theory-tips" id="colorTheoryTips">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #333; margin: 0; font-size: 1rem;">ğŸ¨ è‰²å½©å°çŸ¥è­˜</h4>
                        <button class="tip-toggle-btn" id="tipToggleBtn" onclick="toggleColorTips()">
                            <span id="tipToggleIcon">ğŸ‘ï¸</span>
                        </button>
                    </div>
                    <div class="tip-content" id="tipContent">
                        <div style="font-size: 0.85rem; color: #666; line-height: 1.4; text-align: center;">
                            ğŸ’¡ ç´…è‰² + é»ƒè‰² = æ©˜è‰²<br>
                            ğŸŒˆ é€™æ˜¯æš–è‰²ç³»çš„ç¶“å…¸çµ„åˆï¼
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµæŸç•«é¢ -->
        <div class="end-screen" id="endScreen" style="display: none;">
            <h1 class="game-title">ğŸ‰ éŠæˆ²çµæŸï¼</h1>
            <p style="font-size: 1.5rem; margin-bottom: 20px; color: #666;" id="finalMessage"></p>
            
            <div class="final-stats" id="finalStats">
                <h3 style="text-align: center; margin-bottom: 20px; color: #333;">ğŸ“Š éŠæˆ²çµ±è¨ˆ</h3>
                <div class="stat-item">
                    <span>æœ€çµ‚åˆ†æ•¸ï¼š</span>
                    <span id="finalScore">0</span>
                </div>
                <div class="stat-item">
                    <span>æ­£ç¢ºç­”æ¡ˆï¼š</span>
                    <span id="finalCorrect">0</span>
                </div>
                <div class="stat-item">
                    <span>éŒ¯èª¤ç­”æ¡ˆï¼š</span>
                    <span id="finalIncorrect">0</span>
                </div>
                <div class="stat-item">
                    <span>æº–ç¢ºç‡ï¼š</span>
                    <span id="finalAccuracy">0%</span>
                </div>
                <div class="stat-item">
                    <span>é”åˆ°é—œå¡ï¼š</span>
                    <span id="finalLevel">1</span>
                </div>
            </div>
            
            <button class="restart-btn" onclick="restartGame()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        let gameState = {
            currentLevel: 1,
            score: 0,
            timer: 60,
            correctAnswers: 0,
            incorrectAnswers: 0,
            targetColor: null,
            selectedColors: [],
            isGameActive: false,
            timerInterval: null,
            usedTargets: [],
            usedTargetsByDifficulty: { easy: [], medium: [], hard: [] },
            consecutiveWrong: 0,
            currentDifficulty: 'easy',
            showColorTips: true
        };

        const colorMixing = {
            // åŸºç¤é¡è‰²
            red: { rgb: [255, 0, 0], hex: '#FF0000', hsl: [0, 100, 50] },
            yellow: { rgb: [255, 255, 0], hex: '#FFFF00', hsl: [60, 100, 50] },
            blue: { rgb: [0, 0, 255], hex: '#0000FF', hsl: [240, 100, 50] },
            white: { rgb: [255, 255, 255], hex: '#FFFFFF', hsl: [0, 0, 100] },
            black: { rgb: [0, 0, 0], hex: '#000000', hsl: [0, 0, 0] },
            
            // é€²éšç‰ˆé¡å¤–é¡è‰²
            orange: { rgb: [255, 165, 0], hex: '#FFA500', hsl: [39, 100, 50] },
            green: { rgb: [0, 128, 0], hex: '#008000', hsl: [120, 100, 25] },
            purple: { rgb: [128, 0, 128], hex: '#800080', hsl: [300, 100, 25] },
            pink: { rgb: [255, 192, 203], hex: '#FFC0CB', hsl: [350, 100, 88] },
            brown: { rgb: [165, 42, 42], hex: '#A52A2A', hsl: [0, 59, 41] },
            gray: { rgb: [128, 128, 128], hex: '#808080', hsl: [0, 0, 50] },
            cyan: { rgb: [0, 255, 255], hex: '#00FFFF', hsl: [180, 100, 50] },
            magenta: { rgb: [255, 0, 255], hex: '#FF00FF', hsl: [300, 100, 50] },
            lime: { rgb: [50, 205, 50], hex: '#32CD32', hsl: [120, 61, 50] },
            navy: { rgb: [0, 0, 128], hex: '#000080', hsl: [240, 100, 25] }
        };

        const colorTheoryTips = [
            {
                colors: ['red', 'yellow'],
                tip: 'ğŸ’¡ ç´…è‰² + é»ƒè‰² = æ©˜è‰²<br>ğŸŒˆ é€™æ˜¯æš–è‰²ç³»çš„ç¶“å…¸çµ„åˆï¼',
                category: 'primary'
            },
            {
                colors: ['blue', 'yellow'],
                tip: 'ğŸ’¡ è—è‰² + é»ƒè‰² = ç¶ è‰²<br>ğŸŒ¿ å†·æš–è‰²èª¿çš„å®Œç¾å¹³è¡¡ï¼',
                category: 'primary'
            },
            {
                colors: ['red', 'blue'],
                tip: 'ğŸ’¡ ç´…è‰² + è—è‰² = ç´«è‰²<br>ğŸ‘‘ ç¥ç§˜é«˜è²´çš„çš‡å®¤è‰²å½©ï¼',
                category: 'primary'
            },
            {
                colors: ['red', 'white'],
                tip: 'ğŸ’¡ ç´…è‰² + ç™½è‰² = ç²‰ç´…è‰²<br>ğŸŒ¸ æº«æŸ”æµªæ¼«çš„æ˜¥å¤©è‰²èª¿ï¼',
                category: 'tint'
            },
            {
                colors: ['blue', 'white'],
                tip: 'ğŸ’¡ è—è‰² + ç™½è‰² = æ·ºè—è‰²<br>â˜ï¸ æ¸…æ–°å¦‚å¤©ç©ºçš„å¯§éœè‰²å½©ï¼',
                category: 'tint'
            },
            {
                colors: ['red', 'black'],
                tip: 'ğŸ’¡ ç´…è‰² + é»‘è‰² = æ·±ç´…è‰²<br>ğŸ· æˆç†Ÿç©©é‡çš„æ·±æ²‰ç¾æ„Ÿï¼',
                category: 'shade'
            },
            {
                colors: ['blue', 'black'],
                tip: 'ğŸ’¡ è—è‰² + é»‘è‰² = æ·±è—è‰²<br>ğŸŒŒ æ·±é‚ƒå¦‚å¤œç©ºçš„ç¥ç§˜è‰²å½©ï¼',
                category: 'shade'
            },
            {
                colors: ['red', 'yellow', 'white'],
                tip: 'ğŸ’¡ ä¸‰è‰²æ··åˆå‰µé€ æ·ºæ©˜è‰²<br>ğŸ‘ æº«æš–æŸ”å’Œçš„æ¡ƒå­è‰²èª¿ï¼',
                category: 'complex'
            },
            {
                colors: ['blue', 'red', 'white'],
                tip: 'ğŸ’¡ ä¸‰è‰²æ··åˆå‰µé€ æ·ºç´«è‰²<br>ğŸ¦„ å¤¢å¹»å„ªé›…çš„è–°è¡£è‰è‰²ï¼',
                category: 'complex'
            },
            {
                colors: ['yellow', 'blue', 'white'],
                tip: 'ğŸ’¡ ä¸‰è‰²æ··åˆå‰µé€ æ·ºç¶ è‰²<br>ğŸŒ± æ¸…æ–°è‡ªç„¶çš„å«©è‘‰è‰²å½©ï¼',
                category: 'complex'
            },
            {
                colors: ['yellow', 'red', 'green'],
                tip: 'ğŸ’¡ ä¸‰è‰²æ··åˆå‰µé€ åœŸé»ƒè‰²<br>ğŸœï¸ å¤§åœ°è‰²ç³»çš„æº«æš–è³ªæ„Ÿï¼',
                category: 'complex'
            }
        ];

        const gameConfig = {
            title: 'ğŸ¨ é»åœŸæ··è‰²éŠæˆ²',
            description: 'æ··åˆé¡è‰²ï¼Œå‰µé€ ç›®æ¨™è‰²å½©ï¼é©åˆæ‰€æœ‰å¹´é½¡çš„æœ‰è¶£é«”é©—',
            colors: ['red', 'yellow', 'blue', 'white', 'black', 'green'],
            targets: {
                easy: [
                    { colors: ['red', 'yellow'], result: [255, 165, 0], name: 'æ©˜è‰²', hex: '#FFA500', difficulty: 'easy' },
                    { colors: ['blue', 'yellow'], result: [0, 128, 0], name: 'ç¶ è‰²', hex: '#008000', difficulty: 'easy' },
                    { colors: ['red', 'blue'], result: [128, 0, 128], name: 'ç´«è‰²', hex: '#800080', difficulty: 'easy' }
                ],
                medium: [
                    { colors: ['red', 'white'], result: [255, 192, 203], name: 'ç²‰ç´…è‰²', hex: '#FFC0CB', difficulty: 'medium' },
                    { colors: ['blue', 'white'], result: [173, 216, 230], name: 'æ·ºè—è‰²', hex: '#ADD8E6', difficulty: 'medium' },
                    { colors: ['yellow', 'green'], result: [154, 205, 50], name: 'æ©„æ¬–è‰²', hex: '#9ACD32', difficulty: 'medium' },
                    { colors: ['red', 'black'], result: [139, 0, 0], name: 'æ·±ç´…è‰²', hex: '#8B0000', difficulty: 'medium' },
                    { colors: ['blue', 'black'], result: [0, 0, 139], name: 'æ·±è—è‰²', hex: '#00008B', difficulty: 'medium' }
                ],
                hard: [
                    // ä¸‰è‰²æ··åˆé¡Œç›® (ç¬¬ä¸‰é—œä¸»è¦å…§å®¹)
                    { colors: ['red', 'yellow', 'white'], result: [255, 220, 177], name: 'æ·ºæ©˜è‰²', hex: '#FFDCB1', difficulty: 'hard' },
                    { colors: ['blue', 'red', 'white'], result: [221, 160, 221], name: 'æ·ºç´«è‰²', hex: '#DDA0DD', difficulty: 'hard' },
                    { colors: ['yellow', 'blue', 'white'], result: [170, 213, 170], name: 'æ·ºç¶ è‰²', hex: '#AAD5AA', difficulty: 'hard' },
                    { colors: ['red', 'yellow', 'black'], result: [170, 128, 0], name: 'æ·±æ©˜è‰²', hex: '#AA8000', difficulty: 'hard' },
                    { colors: ['blue', 'red', 'black'], result: [85, 0, 85], name: 'æ·±ç´«è‰²', hex: '#550055', difficulty: 'hard' },
                    { colors: ['yellow', 'blue', 'black'], result: [85, 128, 85], name: 'æ·±ç¶ è‰²', hex: '#558055', difficulty: 'hard' },
                    { colors: ['red', 'blue', 'green'], result: [128, 64, 128], name: 'æ··åˆç´«', hex: '#804080', difficulty: 'hard' },
                    { colors: ['yellow', 'red', 'green'], result: [170, 128, 85], name: 'åœŸé»ƒè‰²', hex: '#AA8055', difficulty: 'hard' },
                    { colors: ['blue', 'yellow', 'green'], result: [85, 170, 85], name: 'é’ç¶ è‰²', hex: '#55AA55', difficulty: 'hard' },
                    { colors: ['red', 'green', 'black'], result: [128, 64, 0], name: 'æ·±æ£•è‰²', hex: '#804000', difficulty: 'hard' },
                    { colors: ['blue', 'green', 'white'], result: [128, 191, 191], name: 'é’ç™½è‰²', hex: '#80BFBF', difficulty: 'hard' },
                    { colors: ['red', 'green', 'yellow'], result: [170, 128, 85], name: 'æ©„æ¬–æ£•', hex: '#AA8055', difficulty: 'hard' },
                    { colors: ['blue', 'green', 'black'], result: [0, 85, 85], name: 'æ·±é’è‰²', hex: '#005555', difficulty: 'hard' },
                    { colors: ['red', 'blue', 'yellow'], result: [170, 85, 170], name: 'æš–ç´«è‰²', hex: '#AA55AA', difficulty: 'hard' },
                    { colors: ['white', 'black', 'red'], result: [170, 85, 85], name: 'ç°ç´…è‰²', hex: '#AA5555', difficulty: 'hard' },
                    { colors: ['white', 'black', 'blue'], result: [85, 85, 170], name: 'ç°è—è‰²', hex: '#5555AA', difficulty: 'hard' },
                    { colors: ['white', 'black', 'yellow'], result: [170, 170, 85], name: 'ç°é»ƒè‰²', hex: '#AAAA55', difficulty: 'hard' },
                    { colors: ['white', 'black', 'green'], result: [85, 128, 85], name: 'ç°ç¶ è‰²', hex: '#558055', difficulty: 'hard' },
                    { colors: ['red', 'green', 'white'], result: [200, 160, 160], name: 'æ·ºæ£•è‰²', hex: '#C8A0A0', difficulty: 'hard' },
                    { colors: ['blue', 'red', 'green'], result: [85, 85, 128], name: 'æ·±ç°ç´«', hex: '#555580', difficulty: 'hard' },
                    
                    // å°‘é‡é›™è‰²é¡Œç›® (é¿å…èˆ‡å‰é¢é—œå¡é‡è¤‡)
                    { colors: ['yellow', 'black'], result: [128, 128, 0], name: 'æ©„æ¬–è‰²', hex: '#808000', difficulty: 'hard' },
                    { colors: ['green', 'white'], result: [144, 238, 144], name: 'æ·ºç¶ è‰²', hex: '#90EE90', difficulty: 'hard' },
                    { colors: ['green', 'black'], result: [0, 100, 0], name: 'æ·±ç¶ è‰²', hex: '#006400', difficulty: 'hard' }
                ]
            },
            requirements: {
                1: { score: 30, accuracy: 60 },
                2: { score: 80, accuracy: 65 },
                3: { score: 150, accuracy: 75, time: 120 }
            }
        };



        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'grid';
            gameState.isGameActive = true;
            gameState.timer = 120;
            setupColorBalls();
            generateNewTarget();
            startTimer();
            setupDragAndDrop();
            updateDisplay();
        }

        function setupColorBalls() {
            const colorBallsContainer = document.getElementById('colorBalls');
            colorBallsContainer.innerHTML = '';
            colorBallsContainer.className = 'color-balls children';
            
            gameConfig.colors.forEach(colorName => {
                const colorData = colorMixing[colorName];
                const ball = document.createElement('div');
                ball.className = 'color-ball';
                ball.style.background = `rgb(${colorData.rgb.join(',')})`;
                ball.dataset.color = colorName;
                ball.draggable = true;
                
                colorBallsContainer.appendChild(ball);
            });
        }

        function generateNewTarget() {
            // æ ¹æ“šé—œå¡å’Œé€£çºŒéŒ¯èª¤æ¬¡æ•¸é¸æ“‡é›£åº¦
            let difficulty = getDifficultyForLevel();
            
            // å¦‚æœé€£çºŒéŒ¯èª¤ï¼Œé™ä½é›£åº¦
            if (gameState.consecutiveWrong >= 2) {
                difficulty = 'easy';
            }
            
            const targets = gameConfig.targets[difficulty];
            
            // ç‚ºæ¯å€‹é›£åº¦ç¶­è­·ç¨ç«‹çš„ä½¿ç”¨è¨˜éŒ„
            if (!gameState.usedTargetsByDifficulty) {
                gameState.usedTargetsByDifficulty = { easy: [], medium: [], hard: [] };
            }
            
            const usedTargetsForDifficulty = gameState.usedTargetsByDifficulty[difficulty];
            
            // é¿å…é‡è¤‡çš„ç›®æ¨™é¡è‰²
            let availableTargets = targets.filter(target => 
                !usedTargetsForDifficulty.includes(target.name)
            );
            
            // å¦‚æœè©²é›£åº¦çš„æ‰€æœ‰ç›®æ¨™éƒ½ç”¨éäº†ï¼Œé‡ç½®è©²é›£åº¦çš„ä½¿ç”¨è¨˜éŒ„
            if (availableTargets.length === 0) {
                gameState.usedTargetsByDifficulty[difficulty] = [];
                availableTargets = targets;
                console.log(`Reset ${difficulty} targets pool - now has ${availableTargets.length} targets available`);
            }
            
            const randomTarget = availableTargets[Math.floor(Math.random() * availableTargets.length)];
            gameState.targetColor = randomTarget;
            gameState.usedTargetsByDifficulty[difficulty].push(randomTarget.name);
            gameState.currentDifficulty = difficulty;
            
            console.log(`Selected ${difficulty} target: ${randomTarget.name}, remaining in pool: ${targets.length - gameState.usedTargetsByDifficulty[difficulty].length}`);
            
            const [r, g, b] = randomTarget.result;
            document.getElementById('targetDisplay').style.background = `rgb(${r}, ${g}, ${b})`;
            
            // é¡¯ç¤ºé¡è‰²è³‡è¨Šå’Œé›£åº¦
            const colorInfo = document.getElementById('colorInfo');
            const difficultyEmoji = { easy: 'â­', medium: 'â­â­', hard: 'â­â­â­' };
            const colorCount = randomTarget.colors.length;
            const colorCountText = colorCount === 2 ? 'é›™è‰²' : 'ä¸‰è‰²';
            
            colorInfo.innerHTML = `
                <div>${randomTarget.name} ${difficultyEmoji[difficulty]} (${colorCountText})</div>
                <div style="font-size: 0.8rem; color: #888;">RGB: (${r}, ${g}, ${b})</div>
            `;
            
            // æ›´æ–°è‰²å½©å­¸æç¤º
            updateColorTheoryTip(randomTarget.colors);
            
            // éš±è—æç¤º
            document.getElementById('hintDisplay').style.display = 'none';
        }

        function updateColorTheoryTip(targetColors) {
            // å°‹æ‰¾åŒ¹é…çš„è‰²å½©å­¸æç¤º
            const matchingTip = colorTheoryTips.find(tip => {
                if (tip.colors.length !== targetColors.length) return false;
                return tip.colors.every(color => targetColors.includes(color));
            });
            
            const tipContent = document.getElementById('tipContent');
            
            if (matchingTip) {
                tipContent.innerHTML = `<div style="font-size: 0.85rem; color: #666; line-height: 1.4; text-align: center;">${matchingTip.tip}</div>`;
            } else {
                // é€šç”¨æç¤º
                const colorNames = targetColors.map(color => getColorName(color));
                const generalTips = [
                    `ğŸ¨ è©¦è©¦æ··åˆ ${colorNames.join(' + ')}ï¼<br>âœ¨ æ¯ç¨®é¡è‰²éƒ½æœ‰ç¨ç‰¹çš„å€‹æ€§ï¼`,
                    `ğŸŒˆ é¡è‰²æ··åˆæ˜¯è—è¡“çš„é­”æ³•ï¼<br>ğŸ­ ç™¼æ®å‰µæ„ï¼Œæ¢ç´¢è‰²å½©ä¸–ç•Œï¼`,
                    `ğŸ’« æ··è‰²å°ç§˜è¨£ï¼šæ…¢æ…¢åŠ å…¥é¡è‰²<br>ğŸª è§€å¯Ÿæ¯ä¸€æ­¥çš„è®ŠåŒ–ï¼`,
                    `ğŸ¨ è‰²å½©æœ‰æº«åº¦ï¼šç´…é»ƒæ©˜æ˜¯æš–è‰²<br>â„ï¸ è—ç¶ ç´«æ˜¯æ¶¼çˆ½çš„å†·è‰²ï¼`
                ];
                const randomTip = generalTips[Math.floor(Math.random() * generalTips.length)];
                tipContent.innerHTML = `<div style="font-size: 0.85rem; color: #666; line-height: 1.4; text-align: center;">${randomTip}</div>`;
            }
        }
        
        function getDifficultyForLevel() {
            if (gameState.currentLevel === 1) {
                return Math.random() < 0.7 ? 'easy' : 'medium';
            } else if (gameState.currentLevel === 2) {
                return Math.random() < 0.5 ? 'medium' : (Math.random() < 0.8 ? 'easy' : 'hard');
            } else {
                // ç¬¬ä¸‰é—œä¸»è¦ä»¥ä¸‰è‰²æ··åˆç‚ºä¸»ï¼Œæ¸›å°‘èˆ‡å‰é¢é—œå¡çš„é‡è¤‡
                const rand = Math.random();
                if (rand < 0.15) return 'easy';   // å¤§å¹…æ¸›å°‘ç°¡å–®é¡Œç›®
                if (rand < 0.25) return 'medium'; // æ¸›å°‘ä¸­ç­‰é¡Œç›®
                return 'hard';                    // ä¸»è¦æ˜¯å›°é›£é¡Œç›®(ä¸‰è‰²æ··åˆ)
            }
        }

        function setupDragAndDrop() {
            const colorBalls = document.querySelectorAll('.color-ball');
            const dropZones = document.querySelectorAll('.drop-zone');

            colorBalls.forEach(ball => {
                ball.addEventListener('dragstart', handleDragStart);
                ball.addEventListener('click', handleColorClick);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.color);
        }

        function handleColorClick(e) {
            const color = e.target.dataset.color;
            const maxColors = gameState.targetColor ? gameState.targetColor.colors.length : 2;
            if (gameState.selectedColors.length < maxColors) {
                addColorToMix(color);
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            const color = e.dataTransfer.getData('text/plain');
            
            const maxColors = gameState.targetColor ? gameState.targetColor.colors.length : 2;
            if (gameState.selectedColors.length < maxColors) {
                addColorToMix(color);
            }
        }

        function addColorToMix(color) {
            const maxColors = gameState.targetColor ? gameState.targetColor.colors.length : 2;
            if (gameState.selectedColors.length < maxColors && !gameState.selectedColors.includes(color)) {
                gameState.selectedColors.push(color);
                updateMixingDisplay();
            }
        }

        function updateMixingDisplay() {
            const dropZones = document.querySelectorAll('.drop-zone');
            const maxColors = gameState.targetColor ? gameState.targetColor.colors.length : 2;
            
            // é¡¯ç¤ºæˆ–éš±è—ç¬¬ä¸‰å€‹æ··è‰²å€åŸŸ
            const dropZone3 = document.getElementById('dropZone3');
            const thirdPlus = document.getElementById('thirdPlus');
            
            if (maxColors === 3) {
                dropZone3.style.display = 'flex';
                thirdPlus.style.display = 'block';
            } else {
                dropZone3.style.display = 'none';
                thirdPlus.style.display = 'none';
            }
            
            gameState.selectedColors.forEach((color, index) => {
                if (dropZones[index]) {
                    const colorData = colorMixing[color];
                    const [r, g, b] = colorData.rgb;
                    dropZones[index].style.background = `rgb(${r}, ${g}, ${b})`;
                    dropZones[index].querySelector('.plus-sign').style.display = 'none';
                }
            });

            if (gameState.selectedColors.length === maxColors) {
                let mixedColor;
                if (maxColors === 2) {
                    mixedColor = mixColors(gameState.selectedColors[0], gameState.selectedColors[1]);
                } else if (maxColors === 3) {
                    mixedColor = mixThreeColors(gameState.selectedColors[0], gameState.selectedColors[1], gameState.selectedColors[2]);
                }
                const [r, g, b] = mixedColor;
                document.getElementById('resultDisplay').style.background = `rgb(${r}, ${g}, ${b})`;
            }
        }

        function mixColors(color1, color2) {
            // ç‰¹æ®Šæ··è‰²è¦å‰‡ - åŸºæ–¼çœŸå¯¦è‰²å½©ç†è«–
            const mixingRules = {
                'red-yellow': [255, 165, 0],    // æ©˜è‰²
                'yellow-red': [255, 165, 0],    // æ©˜è‰²
                'blue-yellow': [0, 128, 0],     // ç¶ è‰²
                'yellow-blue': [0, 128, 0],     // ç¶ è‰²
                'red-blue': [128, 0, 128],      // ç´«è‰²
                'blue-red': [128, 0, 128],      // ç´«è‰²
                'red-white': [255, 192, 203],   // ç²‰ç´…è‰²
                'white-red': [255, 192, 203],   // ç²‰ç´…è‰²
                'blue-white': [173, 216, 230],  // æ·ºè—è‰²
                'white-blue': [173, 216, 230],  // æ·ºè—è‰²
                'yellow-white': [255, 255, 224], // æ·ºé»ƒè‰²
                'white-yellow': [255, 255, 224], // æ·ºé»ƒè‰²
                'red-black': [139, 0, 0],       // æ·±ç´…è‰²
                'black-red': [139, 0, 0],       // æ·±ç´…è‰²
                'blue-black': [0, 0, 139],      // æ·±è—è‰²
                'black-blue': [0, 0, 139],      // æ·±è—è‰²
                'yellow-black': [128, 128, 0],  // æ©„æ¬–è‰²
                'black-yellow': [128, 128, 0],  // æ©„æ¬–è‰²
                'green-white': [144, 238, 144], // æ·ºç¶ è‰²
                'white-green': [144, 238, 144], // æ·ºç¶ è‰²
                'green-black': [0, 100, 0],     // æ·±ç¶ è‰²
                'black-green': [0, 100, 0],     // æ·±ç¶ è‰²
                'yellow-green': [154, 205, 50], // æ©„æ¬–è‰²
                'green-yellow': [154, 205, 50]  // æ©„æ¬–è‰²
            };
            
            const key = `${color1}-${color2}`;
            if (mixingRules[key]) {
                return mixingRules[key];
            }
            
            // å¦‚æœæ²’æœ‰ç‰¹æ®Šè¦å‰‡ï¼Œä½¿ç”¨å¹³å‡æ··åˆ
            const [r1, g1, b1] = colorMixing[color1].rgb;
            const [r2, g2, b2] = colorMixing[color2].rgb;
            
            return [
                Math.round((r1 + r2) / 2),
                Math.round((g1 + g2) / 2),
                Math.round((b1 + b2) / 2)
            ];
        }

        function mixThreeColors(color1, color2, color3) {
            const [r1, g1, b1] = colorMixing[color1].rgb;
            const [r2, g2, b2] = colorMixing[color2].rgb;
            const [r3, g3, b3] = colorMixing[color3].rgb;
            
            return [
                Math.round((r1 + r2 + r3) / 3),
                Math.round((g1 + g2 + g3) / 3),
                Math.round((b1 + b2 + b3) / 3)
            ];
        }

        function checkAnswer() {
            const maxColors = gameState.targetColor ? gameState.targetColor.colors.length : 2;
            
            if (gameState.selectedColors.length !== maxColors) {
                const colorText = maxColors === 2 ? 'å…©å€‹' : 'ä¸‰å€‹';
                showFeedback(`è«‹é¸æ“‡${colorText}é¡è‰²ï¼`, 'incorrect');
                return;
            }

            let userMix;
            if (maxColors === 2) {
                userMix = mixColors(gameState.selectedColors[0], gameState.selectedColors[1]);
            } else {
                userMix = mixThreeColors(gameState.selectedColors[0], gameState.selectedColors[1], gameState.selectedColors[2]);
            }
            
            const targetMix = gameState.targetColor.result;
            
            // æª¢æŸ¥æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…è¦çš„é¡è‰²
            const hasAllColors = gameState.targetColor.colors.every(color => 
                gameState.selectedColors.includes(color)
            );
            
            // æ›´å¯¬é¬†çš„é¡è‰²æ¯”å°ï¼ˆæ ¹æ“šé›£åº¦èª¿æ•´å®¹å¿åº¦ï¼‰
            const tolerance = gameState.currentDifficulty === 'easy' ? 60 : 
                             gameState.currentDifficulty === 'medium' ? 45 : 30;
            
            const isCorrect = colorsMatch(userMix, targetMix, tolerance) || hasAllColors;

            if (isCorrect) {
                const points = gameState.currentDifficulty === 'easy' ? 5 : 
                              gameState.currentDifficulty === 'medium' ? 10 : 15;
                gameState.score += points;
                gameState.correctAnswers++;
                gameState.consecutiveWrong = 0;
                showFeedback(`æ­£ç¢ºï¼ +${points}åˆ†`, 'correct');
                
                // éš±è—æç¤º
                document.getElementById('hintDisplay').style.display = 'none';
            } else {
                gameState.score = Math.max(0, gameState.score - 1);
                gameState.incorrectAnswers++;
                gameState.consecutiveWrong++;
                showFeedback('å†è©¦è©¦çœ‹ï¼ -1åˆ†', 'incorrect');
                
                // é€£çºŒéŒ¯èª¤å…©æ¬¡å¾Œé¡¯ç¤ºæç¤º
                if (gameState.consecutiveWrong >= 2) {
                    showHint();
                }
            }

            updateDisplay();
            resetMixing();
            
            setTimeout(() => {
                checkLevelProgress();
            }, 1500);
        }
        
        function showHint() {
            const hintDisplay = document.getElementById('hintDisplay');
            const targetColors = gameState.targetColor.colors;
            
            // é«˜äº®æ­£ç¢ºçš„é¡è‰²çƒ
            const colorBalls = document.querySelectorAll('.color-ball');
            colorBalls.forEach(ball => {
                if (targetColors.includes(ball.dataset.color)) {
                    ball.style.border = '4px solid #FFE66D';
                    ball.style.boxShadow = '0 0 15px rgba(255, 230, 109, 0.8)';
                } else {
                    ball.style.border = '4px solid white';
                    ball.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
                }
            });
            
            hintDisplay.innerHTML = `ğŸ’¡ æç¤ºï¼šè©¦è©¦ç”¨ ${targetColors.map(color => {
                const colorData = colorMixing[color];
                return `<span style="color: ${colorData.hex}; font-weight: bold;">${getColorName(color)}</span>`;
            }).join(' + ')} ä¾†æ··åˆï¼`;
            hintDisplay.style.display = 'block';
        }
        
        function getColorName(colorKey) {
            const names = {
                red: 'ç´…è‰²', yellow: 'é»ƒè‰²', blue: 'è—è‰²',
                white: 'ç™½è‰²', black: 'é»‘è‰²', green: 'ç¶ è‰²'
            };
            return names[colorKey] || colorKey;
        }

        function colorsMatch(color1, color2, tolerance = 30) {
            const [r1, g1, b1] = color1;
            const [r2, g2, b2] = color2;
            
            return Math.abs(r1 - r2) <= tolerance && 
                   Math.abs(g1 - g2) <= tolerance && 
                   Math.abs(b1 - b2) <= tolerance;
        }

        function showFeedback(message, type) {
            const feedback = document.createElement('div');
            feedback.className = `feedback ${type}`;
            feedback.textContent = message;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                if (document.body.contains(feedback)) {
                    document.body.removeChild(feedback);
                }
            }, 1500);
        }



        function clearColors() {
            gameState.selectedColors = [];
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                zone.style.background = 'rgba(255,255,255,0.5)';
                zone.querySelector('.plus-sign').style.display = 'block';
            });
            
            // éš±è—ç¬¬ä¸‰å€‹æ··è‰²å€åŸŸ
            document.getElementById('dropZone3').style.display = 'none';
            document.getElementById('thirdPlus').style.display = 'none';
            
            document.getElementById('resultDisplay').style.background = '#f0f0f0';
            
            // é‡ç½®é¡è‰²çƒçš„é«˜äº®æ•ˆæœ
            const colorBalls = document.querySelectorAll('.color-ball');
            colorBalls.forEach(ball => {
                ball.style.border = '4px solid white';
                ball.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
            });
            
            showFeedback('é¡è‰²å·²æ¸…é™¤ï¼', 'correct');
        }

        function resetMixing() {
            gameState.selectedColors = [];
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                zone.style.background = 'rgba(255,255,255,0.5)';
                zone.querySelector('.plus-sign').style.display = 'block';
            });
            
            // éš±è—ç¬¬ä¸‰å€‹æ··è‰²å€åŸŸ
            document.getElementById('dropZone3').style.display = 'none';
            document.getElementById('thirdPlus').style.display = 'none';
            
            document.getElementById('resultDisplay').style.background = '#f0f0f0';
            generateNewTarget();
        }

        function checkLevelProgress() {
            const req = gameConfig.requirements[gameState.currentLevel];
            const totalAnswers = gameState.correctAnswers + gameState.incorrectAnswers;
            const accuracy = totalAnswers > 0 ? (gameState.correctAnswers / totalAnswers) * 100 : 0;
            
            console.log(`Checking progress - Level: ${gameState.currentLevel}, Score: ${gameState.score}, Required Score: ${req.score}, Accuracy: ${accuracy.toFixed(1)}%, Required: ${req.accuracy}%`);
            
            if (gameState.currentLevel === 3) {
                // ç¬¬ä¸‰é—œï¼šé”åˆ°åˆ†æ•¸å’Œæº–ç¢ºç‡è¦æ±‚ï¼Œæˆ–æ™‚é–“åˆ°
                if ((gameState.score >= req.score && accuracy >= req.accuracy) || gameState.timer <= 0) {
                    if (gameState.score >= req.score && accuracy >= req.accuracy) {
                        levelComplete();
                    } else {
                        gameOver();
                    }
                }
            } else {
                // ç¬¬ä¸€ã€äºŒé—œï¼šé”åˆ°åˆ†æ•¸å’Œæº–ç¢ºç‡è¦æ±‚å³å¯å‡ç´š
                if (gameState.score >= req.score && accuracy >= req.accuracy) {
                    levelComplete();
                }
            }
        }

        function levelComplete() {
            if (gameState.currentLevel >= 3) {
                gameWin();
            } else {
                // é¡¯ç¤ºé—œå¡å®Œæˆè¨Šæ¯
                showFeedback(`ç¬¬${gameState.currentLevel}é—œå®Œæˆï¼`, 'correct');
                
                // å‡ç´šåˆ°ä¸‹ä¸€é—œ
                gameState.currentLevel++;
                
                // é‡ç½®é—œå¡é€²åº¦è¨ˆæ•¸å™¨
                gameState.correctAnswers = 0;
                gameState.usedTargets = [];
                // é‡ç½®é¡Œç›®æ± ï¼Œè®“æ–°é—œå¡æœ‰å…¨æ–°çš„é¡Œç›®é«”é©—
                gameState.usedTargetsByDifficulty = { easy: [], medium: [], hard: [] };
                
                // å»¶é²é¡¯ç¤ºæ–°é—œå¡é–‹å§‹è¨Šæ¯
                setTimeout(() => {
                    showFeedback(`ç¬¬${gameState.currentLevel}é—œé–‹å§‹ï¼`, 'correct');
                    updateDisplay();
                }, 1000);
                
                console.log(`Level up! Now at level ${gameState.currentLevel}, correctAnswers reset to ${gameState.correctAnswers}`);
            }
        }

        function gameWin() {
            gameState.isGameActive = false;
            clearInterval(gameState.timerInterval);
            
            // é¡¯ç¤ºæœ€çµ‚çµ±è¨ˆ
            setTimeout(() => {
                showFinalStats('ğŸ‰ æ­å–œé€šé—œï¼ä½ æ˜¯æ··è‰²å¤§å¸«ï¼');
            }, 500);
        }

        function gameOver() {
            gameState.isGameActive = false;
            clearInterval(gameState.timerInterval);
            
            // é¡¯ç¤ºæœ€çµ‚çµ±è¨ˆ
            setTimeout(() => {
                showFinalStats('â° æ™‚é–“åˆ°äº†ï¼å†è©¦ä¸€æ¬¡å§ï¼');
            }, 500);
        }

        function showFinalStats(message) {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('endScreen').style.display = 'flex';
            document.getElementById('finalMessage').textContent = message;
            
            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const totalAnswers = gameState.correctAnswers + gameState.incorrectAnswers;
            const accuracy = totalAnswers > 0 ? Math.round((gameState.correctAnswers / totalAnswers) * 100) : 0;
            
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCorrect').textContent = gameState.correctAnswers;
            document.getElementById('finalIncorrect').textContent = gameState.incorrectAnswers;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('finalLevel').textContent = gameState.currentLevel;
        }

        function startTimer() {
            gameState.timerInterval = setInterval(() => {
                if (gameState.isGameActive && gameState.timer > 0) {
                    gameState.timer--;
                    updateDisplay();
                    
                    if (gameState.timer <= 0 && gameState.currentLevel === 3) {
                        checkLevelProgress();
                    }
                }
            }, 1000);
        }

        function updateDisplay() {
            document.getElementById('timer').textContent = gameState.timer;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.currentLevel;
            
            const req = gameConfig.requirements[gameState.currentLevel];
            const totalAnswers = gameState.correctAnswers + gameState.incorrectAnswers;
            const accuracy = totalAnswers > 0 ? (gameState.correctAnswers / totalAnswers) * 100 : 0;
            
            let progress, progressText;
            
            if (gameState.currentLevel === 3) {
                // ç¬¬ä¸‰é—œé¡¯ç¤ºåˆ†æ•¸å’Œæº–ç¢ºç‡é€²åº¦
                const scoreProgress = Math.min((gameState.score / req.score) * 100, 100);
                const accuracyProgress = Math.min((accuracy / req.accuracy) * 100, 100);
                progress = Math.min(scoreProgress, accuracyProgress);
                progressText = `${gameState.score}/${req.score}åˆ† | ${accuracy.toFixed(0)}%/${req.accuracy}%`;
            } else {
                // ç¬¬ä¸€ã€äºŒé—œé¡¯ç¤ºåˆ†æ•¸å’Œæº–ç¢ºç‡é€²åº¦
                const scoreProgress = Math.min((gameState.score / req.score) * 100, 100);
                const accuracyProgress = Math.min((accuracy / req.accuracy) * 100, 100);
                progress = Math.min(scoreProgress, accuracyProgress);
                progressText = `${gameState.score}/${req.score}åˆ† | ${accuracy.toFixed(0)}%/${req.accuracy}%`;
            }
            
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = progressText;
        }

        function restartGame() {
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState = {
                currentLevel: 1,
                score: 0,
                timer: 120,
                correctAnswers: 0,
                incorrectAnswers: 0,
                targetColor: null,
                selectedColors: [],
                isGameActive: false,
                timerInterval: null,
                usedTargets: [],
                usedTargetsByDifficulty: { easy: [], medium: [], hard: [] },
                consecutiveWrong: 0,
                currentDifficulty: 'easy'
            };
            
            document.getElementById('endScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }

        function toggleColorTips() {
            gameState.showColorTips = !gameState.showColorTips;
            const tipContent = document.getElementById('tipContent');
            const tipIcon = document.getElementById('tipToggleIcon');
            
            if (gameState.showColorTips) {
                tipContent.classList.remove('hidden');
                tipIcon.textContent = 'ğŸ‘ï¸';
                showFeedback('è‰²å½©æç¤ºå·²é–‹å•Ÿï¼', 'correct');
            } else {
                tipContent.classList.add('hidden');
                tipIcon.textContent = 'ğŸ™ˆ';
                showFeedback('è‰²å½©æç¤ºå·²é—œé–‰ï¼', 'incorrect');
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // éŠæˆ²å•Ÿå‹•æ™‚é¡¯ç¤ºç‰ˆæœ¬é¸æ“‡
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e654b8c7da8460',t:'MTc1Nzc1MjczMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
