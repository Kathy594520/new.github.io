<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é…è‰²ç·´ç¿’éŠæˆ²ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:linear-gradient(180deg,#FEF3C7,#FCE7F3)}
    .swatch{width:84px;height:84px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer;border:2px solid rgba(0,0,0,0.06)}
    .swatch.selected{outline:4px solid rgba(0,0,0,0.12);transform:translateY(-4px)}
    .swatch .meta{font-size:10px;margin-top:6px;color:#111}
    .grid-wrap{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .btn{padding:8px 14px;border-radius:10px}
    .correct-tag{position:absolute;right:6px;top:6px;font-weight:700;background:white;padding:2px 6px;border-radius:10px}
    .wheel-wrap{width:260px;height:260px;display:flex;align-items:center;justify-content:center}
    svg{max-width:100%;height:auto}
    path.segment{transition:stroke-width .18s,filter .18s}
    path.segment.highlight{stroke:#111;stroke-width:4}
    path.segment.correct{stroke:green;stroke-width:3}
    path.segment.wrong{stroke:red;stroke-width:3}
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
  <div class="max-w-5xl w-full bg-white p-6 rounded-2xl shadow-lg">
    <h1 class="text-2xl font-bold mb-2">ğŸ¨ é…è‰²ç·´ç¿’éŠæˆ²ï¼ˆä¿®æ­£ç‰ˆï¼‰</h1>
    <p class="text-sm text-gray-600 mb-4">æ–°å¢ã€Œç¢ºå®šç­”æ¡ˆã€æŒ‰éˆ•èˆ‡ä¿®æ­£ã€ŒåŒé¡è‰²ã€åˆ¤å®šé‚è¼¯ï¼ˆéœ€é¸ 3 å€‹ä»¥ä¸Šï¼Œä¸”ç‚ºèˆ‡ä¸»è‰²åŒä¸€è‰²ç³»ï¼‰ã€‚</p>

    <div class="flex gap-8 flex-col md:flex-row">
      <div class="flex-1">
        <div id="instruction" class="text-lg font-semibold text-blue-700 mb-3"></div>
        <div id="gameArea" class="grid-wrap mb-4"></div>
        <div class="flex gap-3 mb-3">
          <button id="confirmBtn" class="btn bg-emerald-500 text-white" title="åœ¨ä½ å®Œæˆé¸æ“‡å¾ŒæŒ‰æ­¤ç¢ºèªç­”æ¡ˆ">ç¢ºå®šç­”æ¡ˆ</button>
          <button id="nextBtn" class="btn bg-blue-500 text-white">ä¸‹ä¸€é¡Œ</button>
          <button id="clearBtn" class="btn bg-gray-200">æ¸…é™¤é¸æ“‡</button>
          <button id="toggleLabels" class="btn bg-gray-100">åˆ‡æ›è‰²å</button>
        </div>
        <div class="flex gap-4 items-center mb-3">
          <div id="feedback" class="font-bold text-md"></div>
          <div id="score" class="ml-auto font-semibold text-purple-700">åˆ†æ•¸ï¼š0</div>
        </div>
        <div class="text-xs text-gray-500">æç¤ºï¼šè‹¥æ˜¯ã€ŒåŒé¡è‰²ã€ï¼Œè«‹è‡³å°‘é¸ 3 å€‹ä¸¦åŒ…å«ç•«é¢ä¸Šçš„ä¸»è‰²ï¼ˆé¡Œç›®æ‰€é¡¯ç¤ºçš„ä¸»è‰²ï¼‰ã€‚é¸å®Œå¾ŒæŒ‰ã€Œç¢ºå®šç­”æ¡ˆã€ã€‚</div>
      </div>

      <div class="w-96 flex flex-col items-center">
        <h2 class="font-semibold mb-2">ğŸ¡ ä¼Šç™»è‰²ç’°ï¼ˆ12 è‰²ï¼‰</h2>
        <div class="wheel-wrap mb-2">
          <svg id="colorWheel" viewBox="0 0 260 260" width="260" height="260" aria-label="è‰²ç’°ç¤ºæ„"></svg>
        </div>
        <div id="wheelLegend" class="text-sm text-gray-700"></div>
        <p class="text-xs text-gray-500 mt-2">è‰²ç’°æœƒä¾ç…§é¡Œç›®è‡ªå‹•æ¨™ç¤ºä¸»è‰²ã€é„°è¿‘èˆ‡äº’è£œè‰²ï¼›åŒé¡è‰²æœƒé¡¯ç¤ºè©²è‰²ç³»ç¯„åœã€‚</p>
      </div>
    </div>
  </div>

  <script>
    // ===== è³‡æ–™ =====
    const colors = [
      '#FF0000','#FF7F00','#FFFF00','#7FFF00','#00FF00','#00FF7F',
      '#00FFFF','#007FFF','#0000FF','#7F00FF','#FF00FF','#FF007F'
    ];
    const colorNames = [
      'ç´…è‰²','æ©™è‰²','é»ƒè‰²','é»ƒç¶ è‰²','ç¶ è‰²','è—ç¶ è‰²',
      'é’è‰²','è—è‰²','é›è‰²','ç´«è‰²','æ´‹ç´…è‰²','ç«ç´…è‰²'
    ];
    const modes = ['é„°è¿‘è‰²','äº’è£œè‰²','åŒé¡è‰²'];

    // ===== ç‹€æ…‹ =====
    let currentMode = '';
    let currentIndex = 0; // ä¸»è‰²ç´¢å¼•
    let labelsOn = true;
    let selectedIndices = new Set();
    let score = 0;

    // ===== å·¥å…·å‡½å¼ =====
    function hexToRgb(hex){ const h=hex.replace('#',''); return {r:parseInt(h.slice(0,2),16), g:parseInt(h.slice(2,4),16), b:parseInt(h.slice(4,6),16)} }
    function rgbToHsl(r,g,b){ r/=255; g/=255; b/=255; const max=Math.max(r,g,b), min=Math.min(r,g,b); let h=0,s=0,l=(max+min)/2; if(max!==min){ const d=max-min; s = l>0.5 ? d/(2-max-min) : d/(max+min); switch(max){case r: h=(g-b)/d + (g<b?6:0); break; case g: h=(b-r)/d + 2; break; case b: h=(r-g)/d + 4; break;} h/=6;} return {h: Math.round(h*360), s:Math.round(s*100), l:Math.round(l*100)} }
    function hueDist(a,b){ let d=Math.abs(a-b); if(d>180) d=360-d; return d }

    // ===== ç•«è‰²ç’° =====
    const wheel = document.getElementById('colorWheel');
    function drawWheel(){
      wheel.innerHTML='';
      const cx=130, cy=130, r=110, seg=12;
      for(let i=0;i<seg;i++){
        const start=(i/seg)*360, end=((i+1)/seg)*360;
        const rad1=(start-90)*Math.PI/180, rad2=(end-90)*Math.PI/180;
        const x1=cx + r*Math.cos(rad1), y1=cy + r*Math.sin(rad1);
        const x2=cx + r*Math.cos(rad2), y2=cy + r*Math.sin(rad2);
        const large = (end-start)>180?1:0;
        const d=`M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`;
        const p = document.createElementNS('http://www.w3.org/2000/svg','path');
        p.setAttribute('d',d);
        p.setAttribute('fill',colors[i]);
        p.setAttribute('data-index',i);
        p.classList.add('segment');
        wheel.appendChild(p);
      }
      // center circle
      const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx',cx); c.setAttribute('cy',cy); c.setAttribute('r',26); c.setAttribute('fill','#fff'); c.setAttribute('stroke','#eee');
      wheel.appendChild(c);
    }

    // ===== UIï¼šè‰²å¡Šæ¸²æŸ“èˆ‡äº’å‹• =====
    const gameArea = document.getElementById('gameArea');
    function renderSwatches(){
      gameArea.innerHTML='';
      colors.forEach((hex,i)=>{
        const wrap = document.createElement('div');
        wrap.className = 'swatch relative';
        wrap.style.background = hex;
        wrap.setAttribute('data-index', i);
        // æ–‡å­—é¡è‰²åˆ¤æ–·
        const {r,g,b} = hexToRgb(hex);
        const luminance = (0.299*r + 0.587*g + 0.114*b);
        const textColor = luminance < 140 ? '#fff' : '#111';
        const label = document.createElement('div');
        label.className = 'meta';
        label.style.color = textColor;
        label.innerHTML = labelsOn ? `${colorNames[i]}<br><span style='font-family:monospace;font-size:10px'>${hex}</span>` : `<span style='font-family:monospace;font-size:10px'>${hex}</span>`;
        wrap.appendChild(label);

        wrap.addEventListener('click', ()=>{
          onSwatchClick(i);
        });
        gameArea.appendChild(wrap);
      });
    }

    function onSwatchClick(i){
      if(currentMode === 'åŒé¡è‰²'){
        // å¤šé¸åˆ‡æ›
        if(selectedIndices.has(i)) selectedIndices.delete(i); else selectedIndices.add(i);
      } else {
        // å–®é¸ï¼šåªä¿ç•™ä¸€å€‹
        if(selectedIndices.has(i)){ selectedIndices.clear(); } else { selectedIndices.clear(); selectedIndices.add(i); }
      }
      updateSelectionUI();
    }

    function updateSelectionUI(){
      const nodes = gameArea.querySelectorAll('.swatch');
      nodes.forEach(n=>{
        const idx = Number(n.getAttribute('data-index'));
        if(selectedIndices.has(idx)) n.classList.add('selected'); else n.classList.remove('selected');
      });
    }

    // ===== ç”¢ç”Ÿé¡Œç›®èˆ‡è©•åˆ†é‚è¼¯ =====
    function newRound(){
      selectedIndices.clear();
      // éš¨æ©Ÿé¸æ“‡ä¸»é¡Œèˆ‡ä¸»è‰²
      currentMode = modes[Math.floor(Math.random()*modes.length)];
      currentIndex = Math.floor(Math.random()*colors.length);
      document.getElementById('instruction').textContent = buildInstruction();
      document.getElementById('feedback').textContent = '';
      renderSwatches();
      drawWheel();
      highlightWheel();
    }

    function buildInstruction(){
      if(currentMode === 'é„°è¿‘è‰²'){
        return `é¡Œç›®ï¼šä¸»è‰²ç‚º ${colorNames[currentIndex]}ã€‚è«‹å¾è‰²å¡Šä¸­é¸å‡º **é„°è¿‘è‰²**ï¼ˆèˆ‡ä¸»è‰²ç›¸é„°çš„è‰²å¡Šä¹‹ä¸€ï¼‰ï¼Œé¸å¥½å¾ŒæŒ‰ã€Œç¢ºå®šç­”æ¡ˆã€ã€‚`;
      } else if(currentMode === 'äº’è£œè‰²'){
        return `é¡Œç›®ï¼šä¸»è‰²ç‚º ${colorNames[currentIndex]}ã€‚è«‹å¾è‰²å¡Šä¸­é¸å‡º **äº’è£œè‰²**ï¼ˆè‰²ç’°ä¸Šç›¸å°çš„è‰²å¡Šï¼‰ï¼Œé¸å¥½å¾ŒæŒ‰ã€Œç¢ºå®šç­”æ¡ˆã€ã€‚`;
      } else {
        return `é¡Œç›®ï¼šä¸»è‰²ç‚º ${colorNames[currentIndex]}ã€‚è«‹é¸å‡º **3 å€‹ä»¥ä¸Šå±¬æ–¼åŒä¸€è‰²ç³»** çš„é¡è‰²ï¼ˆå¿…é ˆåŒ…å«ä¸»è‰²ï¼‰ï¼Œé¸å¥½å¾ŒæŒ‰ã€Œç¢ºå®šç­”æ¡ˆã€ã€‚`;
      }
    }

    function evaluate(){
      const picked = Array.from(selectedIndices).sort((a,b)=>a-b);
      if(currentMode === 'é„°è¿‘è‰²'){
        if(picked.length !== 1){ wrong('è«‹åªé¸ 1 å€‹é¡è‰²ä½œç‚ºç­”æ¡ˆ'); return; }
        const n1 = (currentIndex+1) % colors.length;
        const n2 = (currentIndex-1+colors.length) % colors.length;
        if(picked[0] === n1 || picked[0] === n2){ correct(); } else { wrong('ç­”æ¡ˆä¸æ­£ç¢ºã€‚é„°è¿‘è‰²æ‡‰ç‚ºä¸»è‰²å·¦å³ç›¸é„°çš„è‰²å¡Šã€‚'); showCorrect([n1,n2]); }
      } else if(currentMode === 'äº’è£œè‰²'){
        if(picked.length !== 1){ wrong('è«‹åªé¸ 1 å€‹é¡è‰²ä½œç‚ºç­”æ¡ˆ'); return; }
        const comp = (currentIndex + 6) % colors.length; // 12 è‰²ç’°äº’è£œç‚ºç›¸å·® 6
        if(picked[0] === comp){ correct(); } else { wrong('ç­”æ¡ˆä¸æ­£ç¢ºã€‚äº’è£œè‰²ä½æ–¼è‰²ç’°çš„ç›¸å°ä½ç½®ã€‚'); showCorrect([comp]); }
      } else if(currentMode === 'åŒé¡è‰²'){
        if(picked.length < 3){ wrong('è«‹è‡³å°‘é¸ 3 å€‹é¡è‰²'); return; }
        // å¿…é ˆåŒ…å«ä¸»è‰²
        if(!selectedIndices.has(currentIndex)){ wrong('ç­”æ¡ˆéœ€åŒ…å«é¡Œç›®ä¸­é¡¯ç¤ºçš„ä¸»è‰²'); return; }
        // æª¢æŸ¥æ¯å€‹é¸æ“‡æ˜¯å¦åœ¨ä¸»è‰²è‰²ç›¸ç¯„åœå…§
        const centerHue = rgbToHsl(...Object.values(hexToRgb(colors[currentIndex]))).h;
        const threshold = 60; // è‰²ç›¸å®¹å·®åº¦æ•¸ï¼Œå«ä¸»è‰² +/-60åº¦
        let allWithin = true;
        Array.from(selectedIndices).forEach(idx=>{
          const h = rgbToHsl(...Object.values(hexToRgb(colors[idx]))).h;
          const d = hueDist(h, centerHue);
          if(d > threshold) allWithin = false;
        });
        if(allWithin){ correct(); } else {
          wrong('æ‰€é¸é¡è‰²ä¸å®Œå…¨å±¬æ–¼ç›¸åŒè‰²ç³»ï¼Œè«‹é¸æ“‡æ›´æ¥è¿‘ä¸»è‰²çš„é¡è‰²ã€‚');
          // é¡¯ç¤ºç†è«–ä¸Šå±¬æ–¼è©²è‰²ç³»çš„ç´¢å¼•
          const expected = [];
          for(let i=0;i<colors.length;i++){
            const h = rgbToHsl(...Object.values(hexToRgb(colors[i]))).h;
            if(hueDist(h, centerHue) <= threshold) expected.push(i);
          }
          showCorrect(expected);
        }
      }
    }

    function correct(){
      document.getElementById('feedback').textContent = 'âœ… æ­£ç¢ºï¼';
      document.getElementById('feedback').className = 'text-green-600 font-semibold';
      score += 10; document.getElementById('score').textContent = `åˆ†æ•¸ï¼š${score}`;
      highlightWheel(true);
    }
    function wrong(msg){
      document.getElementById('feedback').textContent = msg;
      document.getElementById('feedback').className = 'text-red-600 font-semibold';
      score = Math.max(0, score-5); document.getElementById('score').textContent = `åˆ†æ•¸ï¼š${score}`;
    }

    // ===== wheel highlight & show correct =====
    function highlightWheel(showExpected=false){
      const segs = wheel.querySelectorAll('path.segment');
      segs.forEach(s=>{ s.classList.remove('highlight','correct','wrong'); s.setAttribute('stroke','transparent'); });
      // æ¨™ç¤ºä¸»è‰²
      const main = segs[currentIndex]; if(main){ main.classList.add('highlight'); main.setAttribute('stroke','#111'); }
      // è‹¥æ˜¯é„°è¿‘è‰²ï¼Œæ¨™ç¤ºé„°è¿‘
      if(currentMode === 'é„°è¿‘è‰²'){
        const n1 = (currentIndex+1)%colors.length; const n2=(currentIndex-1+colors.length)%colors.length;
        segs[n1].classList.add('correct'); segs[n2].classList.add('correct');
      }
      if(currentMode === 'äº’è£œè‰²'){
        const comp = (currentIndex+6)%colors.length; segs[comp].classList.add('correct');
      }
      if(currentMode === 'åŒé¡è‰²'){
        const centerHue = rgbToHsl(...Object.values(hexToRgb(colors[currentIndex]))).h; const thresh=60;
        for(let i=0;i<colors.length;i++){
          const h = rgbToHsl(...Object.values(hexToRgb(colors[i]))).h; if(hueDist(h, centerHue)<=thresh) segs[i].classList.add('correct');
        }
      }
      // æ¨™ç¤ºç©å®¶é¸æ“‡ç‚º wrong if not in expected
      const picked = Array.from(selectedIndices);
      if(picked.length){
        picked.forEach(idx=>{
          if(!segs[idx].classList.contains('correct')) segs[idx].classList.add('wrong');
        });
      }
    }

    function showCorrect(indices){
      // å¼·åˆ¶æŠŠé¸å–å¤–çš„é æœŸæ­£ç¢ºç­”æ¡ˆé«˜äº®é¡¯ç¤º
      const segs = wheel.querySelectorAll('path.segment');
      segs.forEach(s=>s.classList.remove('wrong'));
      indices.forEach(i=>{ const s=segs[i]; if(s) s.classList.add('correct'); });
    }

    // ===== äº‹ä»¶ç¶å®š =====
    document.getElementById('confirmBtn').addEventListener('click', ()=>{ evaluate(); highlightWheel(true); });
    document.getElementById('nextBtn').addEventListener('click', ()=>{ newRound(); });
    document.getElementById('clearBtn').addEventListener('click', ()=>{ selectedIndices.clear(); updateSelectionUI(); document.getElementById('feedback').textContent=''; });
    document.getElementById('toggleLabels').addEventListener('click', ()=>{ labelsOn = !labelsOn; renderSwatches(); });

    // ===== åˆå§‹åŒ– =====
    drawWheel();
    newRound();
  </script>
</body>
</html>
