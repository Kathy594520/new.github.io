<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生命靈數計算與探索 - 星夜占卜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            /* 深邃的星空背景 */
            background-color: #0f172a; /* Slate-900 */
            color: #f1f5f9; /* Slate-100 */
            /* subtle cosmic gradient */
            background-image: radial-gradient(at 0% 0%, #1e3a8a 0%, transparent 50%), 
                              radial-gradient(at 100% 100%, #4c1d95 0%, transparent 50%);
            background-blend-mode: multiply;
        }
        .card {
            background-color: #1e293b; /* Slate-800 - 星夜卡片 */
            box-shadow: 0 15px 30px rgba(76, 29, 149, 0.4); /* 神秘紫影 */
            border: 1px solid #4c1d95;
        }
        .btn-primary {
            /* 浪漫的玫瑰金色 */
            background-color: #f472b6; /* Pink-400 */
            color: #1e293b; 
            font-weight: 700;
            transition: background-color 0.3s, transform 0.1s;
        }
        .btn-primary:hover {
            background-color: #ec4899; /* Pink-500 */
            transform: translateY(-1px);
        }
        input {
            background-color: #334155 !important; /* Slate-700 for input */
            color: #f1f5f9 !important;
            border-color: #4c1d95 !important;
        }
        input:focus {
             border-color: #a78bfa !important; /* Violet-400 focus */
             box-shadow: 0 0 0 2px #a78bfa !important;
        }
        .num-btn {
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .num-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(244, 114, 182, 0.5);
        }
        .active-num {
            /* 魔法光暈 */
            background-color: #a78bfa !important; /* Violet-400 */
            border-color: #7c3aed !important; /* Violet-600 */
            color: white !important;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(167, 139, 250, 0.8);
        }
        .border-l-4-analysis {
            /* 確保分析區塊的邊框色有正確的對比度 */
            border-left-width: 4px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto p-6 md:p-10 rounded-xl card">
        <h1 class="text-3xl font-bold text-center mb-6 border-b border-purple-500 pb-2 text-pink-300">
            🌌 星夜占卜：生命靈數互動探索 🔮
        </h1>
        <!-- 設計者署名 -->
        <p class="text-center text-sm mb-8 text-violet-400/80">
            [設計者: 仙姑凱西]
        </p>
        
        <!-- 輸入區塊 -->
        <div class="mb-8 p-4 bg-slate-700/50 rounded-lg border border-slate-600">
            <h2 class="text-xl font-semibold mb-4 text-violet-300">💫 請輸入您的誕生密碼</h2>
            <div class="grid grid-cols-3 gap-4">
                <input type="number" id="inputYear" placeholder="年份 (e.g., 1990)" min="1900" max="2100" class="p-3 border-2 rounded-lg transition duration-150" aria-label="年份">
                <input type="number" id="inputMonth" placeholder="月份 (e.g., 5)" min="1" max="12" class="p-3 border-2 rounded-lg transition duration-150" aria-label="月份">
                <input type="number" id="inputDay" placeholder="日期 (e.g., 21)" min="1" max="31" class="p-3 border-2 rounded-lg transition duration-150" aria-label="日期">
            </div>
            <button id="calculateButton" class="w-full mt-5 p-3 rounded-lg btn-primary text-slate-900 text-lg">
                ✨ 啟動我的生命靈數計算 ✨
            </button>
            <p id="error-message" class="text-rose-400 mt-2 text-sm hidden">請輸入有效的年月日。</p>
        </div>

        <!-- 結果與分析顯示區塊 -->
        <div id="resultContainer" class="hidden">
            
            <div class="text-center mb-8">
                <p class="text-xl text-slate-300 mb-2">🔢 您的命運數字是：</p>
                <div class="inline-block px-8 py-4 bg-slate-900/50 border-4 rounded-full shadow-2xl">
                    <span id="result-emoji" class="text-6xl mr-3 align-middle" role="img" aria-label="Emoji"></span> 
                    <span id="result-number" class="text-6xl font-extrabold text-pink-300 drop-shadow-lg align-middle"></span>
                </div>
            </div>

            <!-- 分析內容 -->
            <div id="analysis-content" class="space-y-6">
                
                <div id="traits-box" class="p-5 border-l-4-analysis bg-slate-700/30 rounded-lg">
                    <h3 class="text-2xl font-bold mb-3 flex items-center text-pink-400">
                        <span class="mr-3">🧬</span> <span id="traits-title"></span> 的星辰特質：
                    </h3>
                    <p id="traits-text" class="text-slate-200 leading-relaxed"></p>
                </div>

                <div id="daily-box" class="p-5 border-l-4-analysis bg-slate-700/30 rounded-lg">
                    <h3 class="text-2xl font-bold mb-3 flex items-center text-sky-400">
                        <span class="mr-3">🌟</span> 今日宇宙訊息 (運勢建議) <span class="text-sm text-sky-200/70 ml-2">(每日隨機更新)</span>：
                    </h3>
                    <p id="daily-advice-text" class="text-slate-200 leading-relaxed"></p>
                </div>

                <div id="action-box" class="p-5 border-l-4-analysis bg-slate-700/30 rounded-lg">
                    <h3 class="text-2xl font-bold mb-3 flex items-center text-amber-400">
                        <span class="mr-3">💡</span> 🌙 冥想與行動建議 <span class="text-sm text-amber-200/70 ml-2">(每日隨機更新)</span>：
                    </h3>
                    <p id="action-advice-text" class="text-slate-200 leading-relaxed"></p>
                </div>
            </div>

            <!-- 數字導航區塊 -->
            <div class="mt-10 pt-6 border-t border-purple-800">
                <p class="text-lg font-semibold text-center mb-4 text-violet-300">探索其他星宿的奧秘：</p>
                <div id="number-buttons" class="grid grid-cols-3 sm:grid-cols-9 gap-2">
                    <!-- Buttons 1-9 generated by JS -->
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 每日隨機選擇邏輯 (確保同一天內結果一致) ---

        /**
         * 根據當前日期和靈數作為種子，從陣列中選擇一個固定的項目。
         * @param {number} number - 生命靈數 (1-9)。
         * @param {Array<string>} adviceArray - 建議的陣列。
         * @returns {string} 當日固定的隨機建議。
         */
        function getDailyAdvice(number, adviceArray) {
            if (!adviceArray || adviceArray.length === 0) return "今日無特殊建議。";

            const today = new Date();
            // 種子字串：YYYYMMDD + LifePathNumber (例如：202510159)
            // 使用padStart確保月份和日期為兩位數
            const seedString = today.getFullYear().toString() + 
                                (today.getMonth() + 1).toString().padStart(2, '0') + 
                                today.getDate().toString().padStart(2, '0') + 
                                number.toString();
            
            // 將種子字串轉換為數字種子
            let seed = 0;
            for (let i = 0; i < seedString.length; i++) {
                seed += seedString.charCodeAt(i);
            }

            // 簡易偽隨機函數 (確保相同種子得到相同結果)
            // 這裡使用 Math.sin 來產生一個基於種子固定的浮點數
            const magicSeed = (Math.sin(seed) * 10000);
            const randomNumber = magicSeed - Math.floor(magicSeed); // 得到 0 到 1 之間的值

            // 計算索引
            const index = Math.floor(randomNumber * adviceArray.length);
            return adviceArray[index];
        }

        // --- 核心計算邏輯 ---

        function calculateLifePathNumber(dateString) {
            let sum = 0;
            for (let i = 0; i < dateString.length; i++) {
                if (dateString[i] >= '0' && dateString[i] <= '9') {
                    sum += parseInt(dateString[i], 10);
                }
            }
            
            while (sum > 9) {
                let tempSum = 0;
                let sumString = sum.toString();
                for (let i = 0; i < sumString.length; i++) {
                    tempSum += parseInt(sumString[i], 10);
                }
                sum = tempSum;
            }
            
            return sum === 0 ? 0 : sum; 
        }

        // --- 生命靈數資料庫 (運勢與行動建議已改為陣列) ---

        const NumerologyData = {
            1: {
                title: "創始之星 (The Initiator)",
                emoji: "🔥",
                traits: "獨立、自信、目標明確的**領導者**，但也易顯得自我。最適合開創。",
                color: "rose",
                dailyAdvice: [
                    "勇敢踏出第一步，主動爭取機會。今天專注於個人成就。",
                    "展現你的領導力，不畏懼做決策。適合啟動新項目。",
                    "信任你的直覺和決心，獨立完成任務會帶來驚喜。",
                    "專注於你的個人品牌和獨立精神，今天適合個人突破。"
                ],
                actionAdvice: [
                    "為一個被延宕的夢想專案制定一個三步驟的行動計畫。",
                    "給自己設定一個有挑戰性的目標，並專注完成它。",
                    "練習以簡潔、有力的方式表達你的核心觀點。",
                    "找出一個你可以獨立完成，無需他人協助的任務來證明自我價值。"
                ]
            },
            2: {
                title: "和諧之月 (The Mediator)",
                emoji: "🌊",
                traits: "敏感、合作、和平。擅長細節，易猶豫或過度妥協。",
                color: "sky",
                dailyAdvice: [
                    "聆聽直覺，溫和協調關係。今天適合團隊合作。",
                    "運用你的同理心和耐心，解決潛在的衝突。",
                    "放慢腳步，享受當下，在細節中尋求完美。",
                    "信任夥伴，將注意力放在建立和諧的氛圍上。"
                ],
                actionAdvice: [
                    "練習溫和地表達需求，修復一段關係。",
                    "找一個安靜的時刻冥想五分鐘，以平靜心緒。",
                    "給予身邊的人一個溫暖的肯定或讚美。",
                    "今天的工作重點應放在與人交流和溝通的品質上。"
                ]
            },
            3: {
                title: "歡樂之光 (The Communicator)",
                emoji: "💖",
                traits: "樂觀、社交、創意。表達力強，但易分心流於膚淺。",
                color: "pink",
                dailyAdvice: [
                    "展現你的才華和幽默感，分享快樂。創意能帶來好運。",
                    "今天是社交的絕佳時機，大方地表達你的想法。",
                    "將焦點放在你的熱情上，你會吸引到正向的人事物。",
                    "允許自己展現光芒，你的樂觀是今日的幸運符。"
                ],
                actionAdvice: [
                    "進行藝術創作或寫作，與朋友分享你的想法。",
                    "與三位朋友聯絡，分享一個有趣的經歷或笑話。",
                    "練習在表達時，同時保持專注，避免思緒跳躍過快。",
                    "給自己一個短暫的舞台，可以是唱歌、演講或任何表演。"
                ]
            },
            4: {
                title: "堅石之基 (The Builder)",
                emoji: "🛡️",
                traits: "務實、紀律、可靠。追求**穩定**，但有時過於固執。",
                color: "indigo",
                dailyAdvice: [
                    "專注於細節和組織。為未來打下穩固基礎。",
                    "執行需要耐心和紀律的工作，你的勤奮會獲得回報。",
                    "檢查你的安全感和財務狀況，務實規劃。",
                    "避免抄捷徑，按部就班是今天的成功關鍵。"
                ],
                actionAdvice: [
                    "整理環境，制定一個月度目標並嚴格執行紀律。",
                    "為你的長期計畫建立一個詳細的步驟清單。",
                    "學習或複習一項能提升你專業技能的實用技術。",
                    "完成一個需要細心和重複檢查的任務。"
                ]
            },
            5: {
                title: "變革之風 (The Free Spirit)",
                emoji: "⚡",
                traits: "自由、好奇、愛冒險。適應力強，但易**逃避承諾**。",
                color: "violet",
                dailyAdvice: [
                    "擁抱改變，嘗試新事物！記得平衡自由與專注。",
                    "今天適合探索未知領域，新的機會可能隱藏在不經意間。",
                    "運用你的適應力，靈活應對計畫外的狀況。",
                    "尋求多樣性，避免被常規束縛，但要記得保持界線。"
                ],
                actionAdvice: [
                    "走出舒適圈，嘗試一種新食物或規劃即興活動。",
                    "找一個方法，讓自由與紀律在你的日常生活中並存。",
                    "閱讀一個與你信念完全不同的主題或書籍。",
                    "練習對重要承諾保持專注，避免因好奇心而分心。"
                ]
            },
            6: {
                title: "慈愛之環 (The Nurturer)",
                emoji: "🌱",
                traits: "責任感、同情心、服務導向。易操心或**過度介入**。",
                color: "fuchsia",
                dailyAdvice: [
                    "將關懷具體化。今天適合照顧自己與家人。",
                    "你的愛意是治癒的力量，特別適合修復關係。",
                    "美化你的居家環境，讓愛與和諧充滿你的空間。",
                    "今天是負責且有義務的一天，展現你的奉獻精神。"
                ],
                actionAdvice: [
                    "為關心的人做一件貼心事，練習平衡付出與接收。",
                    "花時間與家人或伴侶深度交流，表達感謝。",
                    "在你的環境中，選擇一個角落進行美化或裝飾。",
                    "承擔一份自願性的責任，給予他人無私的幫助。"
                ]
            },
            7: {
                title: "智慧之泉 (The Seeker)",
                emoji: "💎",
                traits: "內省、分析、追求真理。直覺強，但可能**孤僻多疑**。",
                color: "teal",
                dailyAdvice: [
                    "給自己獨處時間思考和學習。相信你的直覺。",
                    "今天適合深入研究複雜主題，尋求智慧的啟發。",
                    "遠離喧囂，沉浸在知識的海洋中，享受內在平靜。",
                    "你的分析能力很強，適合找出問題的核心。"
                ],
                actionAdvice: [
                    "進行深度閱讀或冥想，探索一個新的哲學概念。",
                    "記錄下你的夢境和直覺閃現的念頭。",
                    "給自己一個完全獨處的夜晚，不使用社交媒體或電子產品。",
                    "提出一個需要徹底分析和驗證的假設或問題。"
                ]
            },
            8: {
                title: "力量之錘 (The Powerhouse)",
                emoji: "👑",
                traits: "權力、組織力、商業頭腦。目標遠大，可能**過於專制**。",
                color: "amber",
                dailyAdvice: [
                    "果斷地處理事業和財務問題。你的決心帶來豐盛。",
                    "展現你掌控局勢的能力，適合進行大膽的商業決策。",
                    "平衡物質與精神層面，追求權力不等於專制。",
                    "今天適合制定長期投資或商業擴張計畫。"
                ],
                actionAdvice: [
                    "審視財務計畫，並採取實際行動達成一個具體目標。",
                    "在做重大決定前，寫下「最壞的結果」來輔助判斷。",
                    "主動向權威人士請教經驗，展現你的企圖心。",
                    "檢查你的資源配置，移除任何低效率的環節。"
                ]
            },
            9: {
                title: "宇宙之心 (The Humanitarian)",
                emoji: "🕊️",
                traits: "同情心、無私、博愛。視野廣闊，但易流於**理想化**。",
                color: "red",
                dailyAdvice: [
                    "運用大愛啟發他人。放下舊怨，服務更廣大的世界。",
                    "今天適合從大局觀看待問題，展現你的寬容和博愛。",
                    "將你的能量導向更有意義的服務或公益活動。",
                    "放下過去的包袱，用寬廣的心胸去迎接新的開始。"
                ],
                actionAdvice: [
                    "完成一個舊計畫以清理空間，思考如何為社區貢圖。",
                    "寫信給一位影響你的人，表達感謝和寬恕。",
                    "練習從另一個角度看問題，避免過度理想化。",
                    "花時間獨處，思考你的人生使命和更高目標。"
                ]
            },
        };

        const resultNumberEl = document.getElementById('result-number');
        const resultEmojiEl = document.getElementById('result-emoji'); // 新增的 Emoji 元素
        const traitsTitleEl = document.getElementById('traits-title');
        const traitsTextEl = document.getElementById('traits-text');
        const dailyAdviceTextEl = document.getElementById('daily-advice-text');
        const actionAdviceTextEl = document.getElementById('action-advice-text');
        const traitsBoxEl = document.getElementById('traits-box');
        const dailyBoxEl = document.getElementById('daily-box');
        const actionBoxEl = document.getElementById('action-box');
        const resultContainerEl = document.getElementById('resultContainer');
        const inputYear = document.getElementById('inputYear');
        const inputMonth = document.getElementById('inputMonth');
        const inputDay = document.getElementById('inputDay');
        const calculateButton = document.getElementById('calculateButton');
        const errorMsgEl = document.getElementById('error-message');
        const numberButtonsContainer = document.getElementById('number-buttons');
        let currentLifePathNumber = null;

        // 輔助函數：清除所有 Tailwind 邊框顏色類
        function removeBorderColors(element) {
            const colors = ["rose", "sky", "pink", "indigo", "violet", "fuchsia", "teal", "amber", "red"];
            colors.forEach(color => {
                element.classList.remove(`border-${color}-500`);
            });
        }

        // 根據數字更新 UI 內容
        function displayResult(number) {
            const data = NumerologyData[number];
            if (!data) return;
            
            const colorClass = `border-${data.color}-500`;

            // 更新主要結果 (數字 + Emoji)
            resultEmojiEl.textContent = data.emoji; // 設置 Emoji
            resultNumberEl.textContent = number;
            
            // 更新分析內容
            traitsTitleEl.textContent = number + " - " + data.title;
            traitsTextEl.textContent = data.traits;
            
            // 這裡使用隨機選擇函數來獲得每日運勢和行動建議
            dailyAdviceTextEl.textContent = getDailyAdvice(number, data.dailyAdvice);
            actionAdviceTextEl.textContent = getDailyAdvice(number, data.actionAdvice);

            // 調整顏色強調 (魔法寶石光暈)
            removeBorderColors(resultNumberEl.parentElement);
            resultNumberEl.parentElement.classList.add(colorClass);

            removeBorderColors(traitsBoxEl);
            traitsBoxEl.classList.add(colorClass);

            removeBorderColors(dailyBoxEl);
            dailyBoxEl.classList.add(colorClass);

            removeBorderColors(actionBoxEl);
            actionBoxEl.classList.add(colorClass);
            
            // 更新數字按鈕的 active 狀態
            document.querySelectorAll('.num-btn').forEach(btn => {
                btn.classList.remove('active-num', 'bg-violet-400', 'border-violet-600');
                btn.classList.add('bg-slate-700/50', 'border-purple-800');
                if (parseInt(btn.textContent) === number) {
                    btn.classList.add('active-num', 'bg-violet-400', 'border-violet-600');
                    btn.classList.remove('bg-slate-700/50', 'border-purple-800');
                }
            });

            // 顯示結果區塊
            resultContainerEl.classList.remove('hidden');
        }

        // 初始化數字按鈕 (1-9)
        function initializeButtons() {
            for (let i = 1; i <= 9; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = 'num-btn p-3 rounded-lg border-2 bg-slate-700/50 border-purple-800 text-lg font-medium text-slate-200 hover:bg-slate-700';
                button.addEventListener('click', () => {
                    displayResult(i);
                });
                numberButtonsContainer.appendChild(button);
            }
        }

        // 計算按鈕事件處理器
        calculateButton.addEventListener('click', () => {
            errorMsgEl.classList.add('hidden');
            
            const year = inputYear.value.trim();
            const month = inputMonth.value.trim();
            const day = inputDay.value.trim();

            if (!year || !month || !day || isNaN(year) || isNaN(month) || isNaN(day)) {
                errorMsgEl.textContent = "請確保年份、月份和日期都已填寫並為數字。";
                errorMsgEl.classList.remove('hidden');
                return;
            }

            const fullDateString = year + month + day;
            currentLifePathNumber = calculateLifePathNumber(fullDateString);

            if (currentLifePathNumber >= 1 && currentLifePathNumber <= 9) {
                displayResult(currentLifePathNumber);
            } else {
                errorMsgEl.textContent = "計算結果無效，請檢查輸入的日期是否合理。";
                errorMsgEl.classList.remove('hidden');
            }
        });

        // 頁面加載完成後初始化
        document.addEventListener('DOMContentLoaded', initializeButtons);
    </script>

</body>
</html>
