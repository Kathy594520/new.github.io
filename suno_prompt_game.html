<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suno AI è©©æ­Œæç¤ºè©ç”¢ç”Ÿå™¨ â€” æ«»èŠ±ç‰ˆï¼ˆä¸»é¡Œä¿å­˜ï¼‰</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&family=Noto+Serif+JP:wght@500;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Noto Sans TC', 'system-ui', 'Segoe UI', 'Arial', 'sans-serif'],
            serifjp: ['Noto Serif JP', 'serif']
          },
          colors: {
            sakura: {
              50: '#fff1f5',
              100: '#ffe4ec',
              200: '#ffc9d8',
              300: '#ff9fba',
              400: '#ff7aa3',
              500: '#ff5a8a',
              600: '#e14a7a',
              700: '#bf3e68',
              800: '#9e3457',
              900: '#7c2a46'
            },
            ink: {
              700: '#374151',
              800: '#1f2937',
              900: '#111827'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(190,24,93,0.08), 0 2px 6px rgba(190,24,93,0.06)',
          }
        }
      }
    }
  </script>

  <style>
    /* æ«»èŠ±èŠ±ç“£èƒŒæ™¯ + å¤šå±¤é£„è½ï¼ˆä¸å†é™åˆ¶æ»¾å‹•ï¼‰ */
    .sakura-bg {
      background: radial-gradient(1200px 600px at -10% -10%, rgba(255,182,193,0.25), transparent 60%),
                  radial-gradient(1000px 700px at 110% 0%, rgba(255,182,193,0.18), transparent 60%),
                  linear-gradient(135deg, #fff7fa 0%, #fff1f5 30%, #ffe9f1 60%, #fff7fa 100%);
      position: relative;
    }

    .petal-layer { position: fixed; inset: 0; pointer-events: none; }
    .layer-far  { opacity: 0.22; }
    .layer-mid  { opacity: 0.32; }
    .layer-near { opacity: 0.42; }

    .petal { 
      position: absolute; 
      top: -12vh; 
      width: var(--size, 24px); 
      height: var(--size, 24px); 
      animation: fall var(--fall, 12s) linear forwards; 
      filter: blur(0.1px);
    }
    .petal .inner { 
      width: 100%; height: 100%; 
      animation: sway var(--swayDur, 4s) ease-in-out infinite alternate; 
      will-change: transform; 
    }
    .petal .leaf { 
      display: block; width: 100%; height: 100%; 
      transform-origin: 50% 50%; 
      animation: spin var(--spin, 10s) linear infinite; 
      filter: drop-shadow(0 2px 2px rgba(190, 24, 93, .08));
    }

    @keyframes fall { 
      0% { transform: translateY(-12vh); }
      100% { transform: translateY(110vh); }
    }
    @keyframes sway {
      0%   { transform: translateX(calc(var(--amp, 24px) * -1)); }
      100% { transform: translateX(var(--amp, 24px)); }
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* é¸å–ç”¨ç´…æ¡†æ¨£å¼ */
    .selected-card {
      background: #fff5f7;
      border-color: #fb7185 !important;
      box-shadow: 0 0 0 2px rgba(251,113,133,0.55) inset;
    }
  </style>
</head>
<body class="min-h-screen sakura-bg font-sans text-ink-800 text-[18px] md:text-[19px] leading-relaxed overflow-x-hidden">

  <!-- èƒŒæ™¯èŠ±ç“£ï¼ˆå¤šå±¤ï¼Œå›ºå®šæ–¼è¦–çª—ï¼›å…§å®¹å¯ä¸‹æ»‘ï¼‰ -->
  <div class="petal-layer layer-far" id="layerFar"></div>
  <div class="petal-layer layer-mid" id="layerMid"></div>
  <div class="petal-layer layer-near" id="layerNear"></div>

  <main class="relative z-10 max-w-7xl mx-auto px-4 py-10 md:py-14">
    <!-- Header -->
    <header class="backdrop-blur-xl bg-white/60 rounded-2xl shadow-soft p-6 md:p-8 border border-white/60">
      <div class="flex items-start justify-between gap-6 flex-wrap">
        <div>
          <h1 class="text-3xl md:text-4xl font-serifjp font-bold tracking-tight flex items-center gap-2">
            <span class="text-sakura-700">ğŸŒ¸ Suno AI</span>
            <span>è©©æ­Œæç¤ºè©ç”¢ç”Ÿå™¨</span>
          </h1>
          <p class="mt-2 text-ink-700">é»é¸ä¸Šæ–¹å¡ç‰‡ï¼ˆå–®é¸ï¼‰å³å¯åŠ å…¥ã€Œæˆ‘çš„é¸æ“‡ã€ï¼Œæˆ–è²¼ä¸Šè©©æ­Œæ–‡å­—è‡ªå‹•åˆ†æï¼Œä¸€éµç”Ÿæˆä¸­è‹±é›™èªæç¤ºè©ã€‚</p>
        </div>
        <div class="flex items-center gap-2 flex-wrap">
          <span class="inline-flex items-center gap-2 text-sm px-3 py-1.5 rounded-full bg-sakura-50 text-sakura-700 border border-sakura-100">
            <span>ğŸ–±ï¸</span><span>é»é¸é¸å–ï¼ˆå–®é¸ï¼‰</span>
          </span>
          <span class="inline-flex items-center gap-2 text-sm px-3 py-1.5 rounded-full bg-sakura-100 text-sakura-800 border border-sakura-200">
            <span>ğŸ‘¤</span><span>è¨­è¨ˆè€…ï¼šä»™å§‘å‡±è¥¿</span>
          </span>


        </div>
      </div>
    </header>

    <!-- Columns -->
    <section class="mt-8 md:mt-12">
      <div class="flex items-stretch gap-4 overflow-x-auto pb-3">
        <!-- æ¬„ä½æ¨¡æ¿ -->
        <template id="column-template">
          <div class="min-w-[230px] w-[230px] bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 max-h-[380px] overflow-y-auto border border-white/70">
            <h3 class="text-sm font-semibold text-ink-800 mb-3 flex items-center justify-between">
              <span class="category-name"></span>
              <span class="text-xs text-ink-700/50 select-none">é»é¸åŠ å…¥</span>
            </h3>
            <div class="space-y-2 items-container"></div>
          </div>
        </template>

        <!-- å¡ç‰‡æ¨¡æ¿ -->
        <template id="item-template">
          <div class="select-item group rounded-lg border border-ink-800/10 bg-white px-3.5 py-2.5 text-[16px] shadow-sm hover:shadow transition flex items-center justify-between gap-2 cursor-pointer">
            <div class="min-w-0">
              <p class="font-medium text-ink-800 leading-5 truncate item-label-zh">â€”</p>
              <p class="text-xs text-ink-700/70 leading-4 truncate item-label-en">â€”</p>
            </div>
            <span class="text-ink-700/30 group-hover:text-sakura-600 transition">ï¼‹</span>
          </div>
        </template>

        <!-- å‹•æ…‹æ’å…¥ -->
        <div id="columns" class="flex gap-4"></div>
      </div>
    </section>

    <!-- æˆ‘çš„é¸æ“‡ + æ§åˆ¶ -->
    <section class="mt-8 md:mt-12">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <!-- æˆ‘çš„é¸æ“‡ -->
        <div class="lg:col-span-2 bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 border border-white/70">
          <div class="flex items-center justify-between gap-4 mb-3">
            <h3 class="text-sm font-semibold text-ink-800">æˆ‘çš„é¸æ“‡</h3>
            <button id="clearSelections" class="text-sm text-ink-700/70 hover:text-ink-800 transition">æ¸…ç©º</button>
          </div>

          <div id="dropzone" class="min-h-[110px] rounded-lg border-2 border-dashed border-sakura-200 bg-white/90 p-3 transition">
            <p id="dropHint" class="text-sm text-ink-700/50 text-center py-6">
              é»é¸ä¸Šæ–¹å¡ç‰‡æœƒè‡ªå‹•åŠ å…¥æ­¤è™•ï¼Œæˆ–ç›´æ¥å¾æ–‡å­—è‡ªå‹•åˆ†æ
            </p>
            <div id="chosenList" class="flex flex-wrap items-start gap-2"></div>
          </div>

          <!-- Token æ¨¡æ¿ -->
          <template id="token-template">
            <div class="token inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-sakura-50 border border-sakura-200 text-sakura-800 text-sm">
              <span class="token-text"></span>
              <button class="remove-token ml-1 text-sakura-500 hover:text-sakura-700 transition" aria-label="ç§»é™¤">âœ•</button>
            </div>
          </template>
        </div>

        <!-- æ“ä½œæŒ‰éˆ• -->
        <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-4 border border-white/70">
          <div class="grid grid-cols-2 gap-3">
            <button id="generateBtn" class="col-span-2 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-sakura-500 text-white font-semibold shadow hover:bg-sakura-600 transition">
              <span>ğŸª„</span><span>ç”Ÿæˆæç¤ºè©</span>
            </button>
            <button id="generateFromTextBtn" class="col-span-2 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-sakura-300 text-ink-900 font-semibold shadow hover:bg-sakura-400 transition">
              <span>ğŸ”</span><span>å¾è©©æ­Œæ–‡å­—ç”Ÿæˆ</span>
            </button>
            <button id="copyBtn" class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-sakura-600 text-white font-semibold shadow hover:bg-sakura-700 disabled:opacity-40 disabled:cursor-not-allowed transition" disabled>
              <span>ğŸ“‹</span><span>è¤‡è£½</span>
            </button>
            <button id="downloadBtn" class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-sakura-700 text-white font-semibold shadow hover:bg-sakura-800 disabled:opacity-40 disabled:cursor-not-allowed transition" disabled>
              <span>â¬‡ï¸</span><span>ä¸‹è¼‰ .txt</span>
            </button>
            <button id="resetBtn" class="col-span-2 inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-ink-900 text-white font-semibold shadow hover:bg-ink-800 transition">
              <span>ğŸ§¹</span><span>å…¨éƒ¨é‡è¨­</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- è¼¸å…¥èˆ‡è¼¸å‡º -->
    <section class="mt-8 md:mt-12 grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-5 border border-white/70">
        <label for="poemInput" class="text-sm font-semibold text-ink-800">è©©æ­Œæ–‡å­—ï¼ˆå¯è²¼ä¸Šæ—¢æœ‰æ­Œè©æˆ–è©©å¥ï¼‰</label>
        <textarea id="poemInput" class="mt-2 w-full h-44 rounded-lg border border-sakura-200 p-3.5 text-[16px] text-ink-800 placeholder-ink-700/40 focus:outline-none focus:ring-2 focus:ring-sakura-300 bg-white/90"
          placeholder="ä¾‹ï¼šé¢¨æŠŠç§˜å¯†æ‚„æ‚„åœ°å¸¶èµ°ï¼Œæœˆè‰²ç‘æ»¿æ—…äººçš„è‚©é ­â€¦â€¦"></textarea>
        <p class="mt-2 text-xs text-ink-700/60">å°æç¤ºï¼šä¸ç”¨å¾ˆé•·ï¼Œå¹¾å¥å°±èƒ½æ¨æ¸¬æƒ…ç·’èˆ‡æ„è±¡ã€‚</p>
      </div>

      <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-soft p-5 border border-white/70">
        <div class="flex items-center justify-between">
          <label class="text-sm font-semibold text-ink-800">è¼¸å‡ºçµæœ</label>
          <button id="shortenBtn" class="text-sm text-ink-700/70 hover:text-ink-800 transition">ç²¾ç°¡/å±•é–‹</button>
        </div>
        <pre id="output" class="mt-2 w-full min-h-[180px] whitespace-pre-wrap rounded-lg border border-sakura-200 p-3.5 text-[16px] text-ink-900 bg-white/90 overflow-auto"></pre>
      </div>
    </section>

    <!-- èˆ’é©çš„ä¸‹æ»‘çµå°¾æ®µï¼Œç¢ºä¿å¯æ»¾å‹• -->
    <section class="mt-12 md:mt-16">
      <div class="bg-white/60 border border-white/70 rounded-2xl shadow-soft p-6">
        <h2 class="text-xl md:text-2xl font-serifjp text-sakura-700 mb-2">å‰µä½œå°æé†’</h2>
        <p class="text-ink-700/90">å…ˆå¾ã€Œä¸»é¡Œã€ã€Œæƒ…ç·’ã€ã€ŒéŸ»å¾‹ã€å„æŒ‘ä¸€å€‹é–‹å§‹ï¼Œç”Ÿæˆå¾Œå†å¾®èª¿é…å™¨æˆ–æ„è±¡ï¼Œèƒ½æ›´å¿«æ‰¾åˆ°æ–¹å‘ã€‚</p>
      </div>
    </section>

    <footer class="mt-14 text-center text-sm text-ink-700/70">
      æœ¬å·¥å…·åƒ…ä½œç‚ºæ–‡æ¡ˆéˆæ„Ÿè¼”åŠ©ï¼Œèˆ‡ä»»ä½•æœå‹™ç„¡é—œã€‚ç¥å‰µä½œé †åˆ©ï¼
    </footer>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full bg-sakura-600 text-white text-sm shadow opacity-0 pointer-events-none transition">
    å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿
  </div>

  <script>
    // æ‰€æœ‰æ¬„ä½
    const CATEGORIES = [
      { key: 'theme', name: 'ä¸»é¡Œ Theme', items: [
        { zh:'å¤§è‡ªç„¶', en:'Nature' },
        { zh:'ç«¥å¹´', en:'Childhood' },
        { zh:'æ—…ç¨‹', en:'Journey' },
        { zh:'å‹èª¼', en:'Friendship' },
        { zh:'å¤¢æƒ³', en:'Dreams' },
        { zh:'æ„›æƒ…', en:'Love' },
        { zh:'ç«¥è©±æ•…äº‹', en:'Fairy tale story' },
      ]},
      { key: 'topic', name: 'é¡Œæ Topic', items: [
        { zh:'å››å­£', en:'Seasons' },
        { zh:'åŸå¸‚ç”Ÿæ´»', en:'City life' },
        { zh:'ç¥è©±å‚³èªª', en:'Myth and legend' },
        { zh:'æ–‡åŒ–å‚³æ‰¿', en:'Cultural heritage' },
        { zh:'å‹èª¼æ•…äº‹', en:'Friendship story' },
        { zh:'å¤¢æƒ³å¸Œæœ›', en:'Dreams and hope' },
      ]},
      { key: 'type', name: 'é¡å‹ Type', items: [
        { zh:'æŠ’æƒ…æ°‘è¬ ', en:'Ballad' },
        { zh:'æµè¡Œæ­Œæ›²', en:'Pop' },
        { zh:'æ–æ»¾', en:'Rock' },
        { zh:'å˜»å“ˆ', en:'Hip-hop' },
        { zh:'é¥’èˆŒ', en:'Rap' },
        { zh:'é›»å­éŸ³æ¨‚', en:'Electronic' },
      ]},
      { key: 'mood', name: 'æƒ…ç·’ Mood', items: [
        { zh:'æµªæ¼«', en:'Romantic' },
        { zh:'æ†‚å‚·', en:'Melancholic' },
        { zh:'å¸Œæœ›', en:'Hopeful' },
        { zh:'æ‡·èˆŠ', en:'Nostalgic' },
        { zh:'ç†±è¡€', en:'Energetic' },
        { zh:'å¹³éœ', en:'Calm' },
      ]},
      { key: 'language', name: 'èªè¨€ Language', items: [
        { zh:'ä¸­æ–‡', en:'Chinese' },
        { zh:'è‹±æ–‡', en:'English' },
        { zh:'é›™èª', en:'Bilingual' },
      ]},
      { key: 'imagery', name: 'æ„è±¡ Imagery', items: [
        { zh:'æ˜Ÿç©º', en:'Stars' },
        { zh:'æµ·æ´‹', en:'Ocean' },
        { zh:'æ£®æ—', en:'Forest' },
        { zh:'åŸå¸‚å¤œè‰²', en:'City nights' },
        { zh:'ç´°é›¨', en:'Rain' },
        { zh:'é£„é›ª', en:'Snow' },
      ]},
      { key: 'structure', name: 'çµæ§‹ Structure', items: [
        { zh:'ä¸»æ­Œ-å‰¯æ­Œ', en:'Verse-Chorus' },
        { zh:'AABA', en:'AABA' },
        { zh:'è‡ªç”±è©©', en:'Free verse' },
        { zh:'ä¿³å¥', en:'Haiku' },
        { zh:'åå››è¡Œè©©', en:'Sonnet' },
      ]},
      { key: 'rhythm', name: 'éŸ»å¾‹ Rhythm', items: [
        { zh:'æ…¢é€Ÿ', en:'Slow tempo' },
        { zh:'ä¸­é€Ÿ', en:'Medium tempo' },
        { zh:'è¼•å¿«', en:'Upbeat' },
        { zh:'è¯çˆ¾æ»‹é¢¨æ ¼', en:'Waltz-like' },
        { zh:'é€²è¡Œæ›²é¢¨æ ¼', en:'March-like' },
        { zh:'æ–æ“ºç¯€å¥', en:'Swing groove' },
      ]},
      { key: 'instrument', name: 'é…å™¨ Instrumentation', items: [
        { zh:'æœ¨å‰ä»–', en:'Acoustic guitar' },
        { zh:'é›»å‰ä»–', en:'Electric guitar' },
        { zh:'é‹¼ç´', en:'Piano' },
        { zh:'å¼¦æ¨‚', en:'Strings' },
        { zh:'çˆµå£«é¼“', en:'Drums' },
        { zh:'é•·ç¬›', en:'Flute' },
        { zh:'è±ç´', en:'Harp' },
        { zh:'ä¸­åœ‹ç¬›', en:'Chinese bamboo flute' },
        { zh:'äºŒèƒ¡', en:'Erhu' },
        { zh:'å¤ç®', en:'Guzheng' },
        { zh:'çµç¶', en:'Pipa' },
        { zh:'ç¬™', en:'Sheng' },
        { zh:'å—©å¶', en:'Suona' },
        { zh:'äº¤éŸ¿æ¨‚åœ˜', en:'Symphony orchestra' },
        { zh:'åˆå”±åœ˜', en:'Choir' },
        { zh:'ä¸–ç•Œæ¨‚å™¨', en:'World instruments' },
      ]},
      { key: 'rhyme', name: 'æŠ¼éŸ» Rhyme', items: [
        { zh:'ABAB', en:'ABAB' },
        { zh:'AABB', en:'AABB' },
        { zh:'ABCB', en:'ABCB' },
        { zh:'è‡ªç”±æŠ¼éŸ»', en:'Free rhyme' },
      ]},
      { key: 'keywords', name: 'é—œéµè© Keywords', items: [
        { zh:'ç™‚ç™’', en:'healing' },
        { zh:'æˆé•·', en:'growth' },
        { zh:'å›å®¶', en:'home' },
        { zh:'é¢¨', en:'wind' },
        { zh:'æœˆå…‰', en:'moonlight' },
      ]},
    ];

    // ç‹€æ…‹
    let selected = []; // å–®é¸ï¼šæ¯ key æœ€å¤š 1
    let uid = 0;
    let compactMode = false;

    // DOM
    const columnsWrap = document.getElementById('columns');
    const columnTpl = document.getElementById('column-template');
    const itemTpl = document.getElementById('item-template');
    const tokenTpl = document.getElementById('token-template');
    const chosenList = document.getElementById('chosenList');
    const dropHint = document.getElementById('dropHint');

    const generateBtn = document.getElementById('generateBtn');
    const generateFromTextBtn = document.getElementById('generateFromTextBtn');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const clearSelectionsBtn = document.getElementById('clearSelections');
    const shortenBtn = document.getElementById('shortenBtn');

    const poemInput = document.getElementById('poemInput');
    const output = document.getElementById('output');
    const toast = document.getElementById('toast');

    // å°å·¥å…·ï¼šåˆ‡æ›ç´…æ¡†æ¨£å¼
    function setCardSelected(el, on) {
      if (!el) return;
      el.classList.toggle('selected-card', !!on);
    }

    // åˆå§‹åŒ–æ¬„ä½
    function initColumns() {
      columnsWrap.innerHTML = '';
      CATEGORIES.forEach(cat => {
        const col = columnTpl.content.firstElementChild.cloneNode(true);
        col.querySelector('.category-name').textContent = cat.name;
        const container = col.querySelector('.items-container');

        cat.items.forEach(opt => {
          const item = itemTpl.content.firstElementChild.cloneNode(true);
          item.dataset.key = cat.key;
          item.dataset.zh = opt.zh;
          item.dataset.en = opt.en;
          item.querySelector('.item-label-zh').textContent = opt.zh;
          item.querySelector('.item-label-en').textContent = opt.en;

          // é»é¸ï¼šå–®é¸åˆ‡æ›
          item.addEventListener('click', () => toggleSingleSelection({ key: cat.key, zh: opt.zh, en: opt.en }, item));

          container.appendChild(item);
        });

        columnsWrap.appendChild(col);
      });
    }

    // å–®é¸åˆ‡æ›
    function toggleSingleSelection(data, itemEl) {
      // æ˜¯å¦åŸæœ¬å°±é¸é€™å¼µ
      const wasSelected = selected.some(s => s.key === data.key && s.zh === data.zh && s.en === data.en);

      // å…ˆæ¸…é™¤åŒåˆ†é¡å·²é¸
      selected = selected.filter(s => s.key !== data.key);
      document.querySelectorAll(`.select-item[data-key="${data.key}"]`).forEach(el => setCardSelected(el, false));

      if (!wasSelected) {
        // åŠ å…¥æ–°é¸æ“‡ä¸¦ç´…æ¡†
        selected.push({ id: `t_${uid++}`, ...data });
        setCardSelected(itemEl, true);
      }

      renderTokens();
    }

    // æ¸²æŸ“é¸æ“‡ token
    function renderTokens() {
      chosenList.innerHTML = '';
      if (selected.length === 0) {
        dropHint.classList.remove('hidden');
      } else {
        dropHint.classList.add('hidden');
      }

      selected.forEach(s => {
        const token = tokenTpl.content.firstElementChild.cloneNode(true);
        token.dataset.id = s.id;
        token.dataset.key = s.key;
        token.querySelector('.token-text').textContent = `${s.zh} / ${s.en}`;
        token.querySelector('.remove-token').addEventListener('click', () => {
          // ç§»é™¤ä¸¦åŒæ­¥å–æ¶ˆç´…æ¡†
          selected = selected.filter(x => x.id !== s.id);
          const el = document.querySelector(`.select-item[data-key="${s.key}"][data-zh="${s.zh}"][data-en="${s.en}"]`);
          setCardSelected(el, false);
          renderTokens();
        });
        chosenList.appendChild(token);
      });
    }

    // ç”Ÿæˆæç¤ºè©
    function buildPrompt() {
      if (selected.length === 0) return 'è«‹å…ˆé»é¸å¹¾å€‹ä¸Šæ–¹é¸é …åŠ å…¥ã€Œæˆ‘çš„é¸æ“‡ã€ï¼Œæˆ–ä½¿ç”¨ã€Œå¾è©©æ­Œæ–‡å­—ç”Ÿæˆã€ã€‚';

      const byKey = (k) => selected.filter(s => s.key === k);
      const listZh = k => byKey(k).map(s => s.zh).join('ã€');
      const listEn = k => byKey(k).map(s => s.en).join(', ');

      const enParts = [];
      const zhParts = [];

      if (byKey('theme').length) { enParts.push(`Theme: ${listEn('theme')}`); zhParts.push(`ä¸»é¡Œï¼š${listZh('theme')}`); }
      if (byKey('topic').length) { enParts.push(`Topic: ${listEn('topic')}`); zhParts.push(`é¡Œæï¼š${listZh('topic')}`); }
      if (byKey('type').length) { enParts.push(`Style: ${listEn('type')}`); zhParts.push(`é¡å‹ï¼š${listZh('type')}`); }
      if (byKey('mood').length) { enParts.push(`Mood: ${listEn('mood')}`); zhParts.push(`æƒ…ç·’ï¼š${listZh('mood')}`); }
      if (byKey('language').length) { enParts.push(`Language: ${listEn('language')}`); zhParts.push(`èªè¨€ï¼š${listZh('language')}`); }
      if (byKey('imagery').length) { enParts.push(`Imagery: ${listEn('imagery')}`); zhParts.push(`æ„è±¡ï¼š${listZh('imagery')}`); }
      if (byKey('structure').length) { enParts.push(`Structure: ${listEn('structure')}`); zhParts.push(`çµæ§‹ï¼š${listZh('structure')}`); }
      if (byKey('rhythm').length) { enParts.push(`Rhythm: ${listEn('rhythm')}`); zhParts.push(`éŸ»å¾‹ï¼š${listZh('rhythm')}`); }
      if (byKey('instrument').length) { enParts.push(`Instrumentation: ${listEn('instrument')}`); zhParts.push(`é…å™¨ï¼š${listZh('instrument')}`); }
      if (byKey('rhyme').length) { enParts.push(`Rhyme: ${listEn('rhyme')}`); zhParts.push(`æŠ¼éŸ»ï¼š${listZh('rhyme')}`); }
      if (byKey('keywords').length) { enParts.push(`Keywords: ${listEn('keywords')}`); zhParts.push(`é—œéµè©ï¼š${listZh('keywords')}`); }

      const enLine = enParts.join(' | ');
      const zhLine = zhParts.join('ï½œ');

      const summaryEN = [
        byKey('mood').length ? `${listEn('mood')} tone` : '',
        byKey('type').length ? `${listEn('type').toLowerCase()} vibe` : '',
        byKey('imagery').length ? `evoke ${listEn('imagery').toLowerCase()}` : '',
        byKey('rhythm').length ? `${listEn('rhythm').toLowerCase()} feel` : '',
        byKey('topic').length ? `topic: ${listEn('topic').toLowerCase()}` : '',
        byKey('theme').length ? `about ${listEn('theme').toLowerCase()}` : ''
      ].filter(Boolean).join(', ');

      const summaryZH = [
        byKey('mood').length ? `${listZh('mood')}æ°›åœ` : '',
        byKey('type').length ? `${listZh('type')}é¢¨æ ¼` : '',
        byKey('imagery').length ? `å¸¶å‡º${listZh('imagery')}æ„è±¡` : '',
        byKey('rhythm').length ? `${listZh('rhythm')}å¾‹å‹•` : '',
        byKey('topic').length ? `é¡Œæç‚º${listZh('topic')}` : '',
        byKey('theme').length ? `åœç¹${listZh('theme')}` : ''
      ].filter(Boolean).join('ã€');

      const lines = [
        'Suno AI Lyric/Poem Prompt',
        '',
        `English: ${summaryEN || 'A vivid, emotionally resonant piece'}. ${enLine}`,
        `ä¸­æ–‡ï¼š${summaryZH || 'ç”Ÿå‹•ã€å¯Œæœ‰æƒ…æ„Ÿå…±é³´çš„ä½œå“'}ã€‚${zhLine}`,
        '',
        'Tips:',
        '- Keep lines concise and imagery-rich.',
        '- Use simple, concrete nouns and verbs.',
        '- Avoid overly abstract wording.'
      ];

      return lines.join('\n');
    }

    // åˆ†ææ–‡å­—ï¼ˆç°¡æ˜“ï¼‰
    function analyzeFromText(text) {
      const t = (text || '').trim();
      if (!t) return 'è«‹è²¼ä¸Šå¹¾å¥æ–‡å­—å†è©¦è©¦ã€‚';

      // é‡ç½®ï¼ˆå–®é¸æ¨¡å¼ï¼‰
      clearAllSelections();

      const dict = {
        mood: [
          { kw: ['æ„›','æº«æŸ”','æ“æŠ±','å¿ƒå‹•','ç”œèœœ'], zh:'æµªæ¼«', en:'Romantic' },
          { kw: ['å“­','å­¤å–®','é»‘å¤œ','å‚·','é›¢åˆ¥','æ³£'], zh:'æ†‚å‚·', en:'Melancholic' },
          { kw: ['å¸Œæœ›','å…‰','æ˜å¤©','é™½å…‰','é‡ç”Ÿ','å‹‡æ°£'], zh:'å¸Œæœ›', en:'Hopeful' },
          { kw: ['å›æ†¶','è€è¡—','å¾å‰','ç«¥å¹´','ç…§ç‰‡'], zh:'æ‡·èˆŠ', en:'Nostalgic' },
          { kw: ['å¥”è·‘','çƒˆç«','ç†±è¡€','è¡','å¶å–Š'], zh:'ç†±è¡€', en:'Energetic' },
          { kw: ['éœ','æ¹–','å¾®é¢¨','å¤œ','é›ª','é›¨'], zh:'å¹³éœ', en:'Calm' },
        ],
        theme: [
          { kw: ['å±±','æµ·','é¢¨','æ¨¹','æ£®æ—','æœˆ','æ˜Ÿ'], zh:'å¤§è‡ªç„¶', en:'Nature' },
          { kw: ['ç«¥å¹´','å­©å­','æ“å ´','èª²æœ¬'], zh:'ç«¥å¹´', en:'Childhood' },
          { kw: ['æ—…ç¨‹','é æ–¹','å‡ºç™¼','è·¯','æ¼‚æ³Š'], zh:'æ—…ç¨‹', en:'Journey' },
          { kw: ['æœ‹å‹','å…„å¼Ÿ','å§å¦¹','å¤¥ä¼´'], zh:'å‹èª¼', en:'Friendship' },
          { kw: ['å¤¢','é¡˜æœ›','è¿½å°‹','æœªä¾†'], zh:'å¤¢æƒ³', en:'Dreams' },
          { kw: ['æˆ€','å¿ƒå‹•','ç›¸é‡','ç‰½æ‰‹'], zh:'æ„›æƒ…', en:'Love' },
        ],
        imagery: [
          { kw: ['æ˜Ÿ','æ˜Ÿç©º','éŠ€æ²³'], zh:'æ˜Ÿç©º', en:'Stars' },
          { kw: ['æµ·','æ³¢æµª','æ½®æ±'], zh:'æµ·æ´‹', en:'Ocean' },
          { kw: ['æ—','æ¨¹','è‘‰','é³¥'], zh:'æ£®æ—', en:'Forest' },
          { kw: ['å¤œ','éœ“è™¹','è¡—ç‡ˆ','åŸå¸‚'], zh:'åŸå¸‚å¤œè‰²', en:'City nights' },
          { kw: ['é›¨','é›¨æ»´','é›²'], zh:'ç´°é›¨', en:'Rain' },
          { kw: ['é›ª','ç™½','å†¬'], zh:'é£„é›ª', en:'Snow' },
        ],
        type: [
          { kw: ['æ–æ»¾','é›»å‰ä»–','å¶å–Š'], zh:'æ–æ»¾', en:'Rock' },
          { kw: ['æµè¡Œ','æ—‹å¾‹','è¼•å¿«'], zh:'æµè¡Œæ­Œæ›²', en:'Pop' },
          { kw: ['é¥’èˆŒ','rap','æŠ¼éŸ»'], zh:'é¥’èˆŒ', en:'Rap' },
          { kw: ['é›»å­','åˆæˆå™¨','ç¯€æ‹'], zh:'é›»å­éŸ³æ¨‚', en:'Electronic' },
          { kw: ['æ°‘è¬ ','æœ¨å‰ä»–'], zh:'æŠ’æƒ…æ°‘è¬ ', en:'Ballad' },
        ]
      };

      // æ¯é¡æŒ‘ç¬¬ä¸€å€‹å‘½ä¸­çš„è©
      Object.entries(dict).forEach(([key, arr]) => {
        const hit = arr.find(rule => rule.kw.some(w => t.includes(w)));
        if (hit) {
          const card = document.querySelector(`.select-item[data-key="${key}"][data-zh="${hit.zh}"][data-en="${hit.en}"]`);
          toggleSingleSelection({ key, zh: hit.zh, en: hit.en }, card || null);
        }
      });

      // è£œé½Šå¸¸ç”¨
      if (!selected.some(s => s.key === 'language')) {
        const card = document.querySelector(`.select-item[data-key="language"][data-zh="é›™èª"]`);
        toggleSingleSelection({ key:'language', zh:'é›™èª', en:'Bilingual' }, card || null);
      }
      if (!selected.some(s => s.key === 'structure')) {
        const card = document.querySelector(`.select-item[data-key="structure"][data-zh="ä¸»æ­Œ-å‰¯æ­Œ"]`);
        toggleSingleSelection({ key:'structure', zh:'ä¸»æ­Œ-å‰¯æ­Œ', en:'Verse-Chorus' }, card || null);
      }
      if (!selected.some(s => s.key === 'type')) {
        const card = document.querySelector(`.select-item[data-key="type"][data-zh="æµè¡Œæ­Œæ›²"]`);
        toggleSingleSelection({ key:'type', zh:'æµè¡Œæ­Œæ›²', en:'Pop' }, card || null);
      }

      return buildPrompt();
    }

    // æ“ä½œå€
    function updateActionsState() {
      const hasText = output.textContent.trim().length > 0;
      copyBtn.disabled = !hasText;
      downloadBtn.disabled = !hasText;
    }

    function showToast(msg = 'å·²å®Œæˆ') {
      toast.textContent = msg;
      toast.style.opacity = '1';
      toast.style.pointerEvents = 'auto';
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.pointerEvents = 'none';
      }, 1400);
    }

    function clearAllSelections() {
      selected = [];
      document.querySelectorAll('.select-item').forEach(el => setCardSelected(el, false));
      renderTokens();
    }

    generateBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const txt = buildPrompt();
      output.textContent = txt;
      updateActionsState();
    });

    generateFromTextBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const txt = analyzeFromText(poemInput.value || '');
      output.textContent = txt;
      updateActionsState();
    });

    copyBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      const txt = output.textContent;
      try {
        await navigator.clipboard.writeText(txt);
        showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
      } catch {
        const ta = document.createElement('textarea');
        ta.value = txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
        showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
      }
    });

    downloadBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const blob = new Blob([output.textContent], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'suno-prompt.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast('å·²ä¸‹è¼‰ .txt');
    });

    resetBtn.addEventListener('click', (e) => {
      e.preventDefault();
      poemInput.value = '';
      output.textContent = '';
      clearAllSelections();
      updateActionsState();
      showToast('å·²é‡è¨­');
    });

    clearSelectionsBtn.addEventListener('click', (e) => {
      e.preventDefault();
      clearAllSelections();
      showToast('å·²æ¸…ç©º');
    });

    shortenBtn.addEventListener('click', (e) => {
      e.preventDefault();
      compactMode = !compactMode;
      shortenBtn.textContent = compactMode ? 'å±•é–‹' : 'ç²¾ç°¡/å±•é–‹';
      if (!output.textContent.trim()) return;
      const full = output.textContent;
      if (compactMode) {
        const lines = full.split('\n');
        const kept = lines.filter(l => /^English:|^ä¸­æ–‡ï¼š/.test(l) || l.startsWith('Suno AI')).join('\n');
        output.textContent = kept || full;
      } else {
        output.textContent = buildPrompt();
      }
    });

    poemInput.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        const txt = analyzeFromText(poemInput.value || '');
        output.textContent = txt;
        updateActionsState();
      }
    });

    // å•Ÿå‹•
    initColumns();
    renderTokens();
    updateActionsState();

    // æ«»èŠ±é£„è½ï¼šå¤šå±¤ç”Ÿæˆï¼ˆå›ºå®šæ–¼è¦–çª—ï¼‰
    const FAR = document.getElementById('layerFar');
    const MID = document.getElementById('layerMid');
    const NEAR = document.getElementById('layerNear');

    function makePetal(color) {
      const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
      svg.setAttribute('viewBox','0 0 24 24');
      svg.setAttribute('fill','none');
      svg.classList.add('petal');

      const size = Math.random()*14 + 14; // 14~28
      const fall = Math.random()*10 + 10; // 10~20s
      const swayDur = Math.random()*3 + 3; // 3~6s
      const spinDur = Math.random()*8 + 8; // 8~16s
      const amp = Math.random()*30 + 16; // 16~46px
      const left = Math.random()*100; // vw
      const delay = Math.random()*6; // s

      svg.style.left = left + 'vw';
      svg.style.setProperty('--size', size + 'px');
      svg.style.setProperty('--fall', fall + 's');
      svg.style.setProperty('--swayDur', swayDur + 's');
      svg.style.setProperty('--spin', spinDur + 's');
      svg.style.setProperty('--amp', amp + 'px');
      svg.style.animationDelay = delay + 's';

      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      g.setAttribute('class','inner');
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('class','leaf');
      path.setAttribute('d','M12 2c3 4 6 6 6 9a6 6 0 1 1-12 0c0-3 3-5 6-9Z');
      path.setAttribute('fill', color);
      g.appendChild(path);
      svg.appendChild(g);
      return svg;
    }

    function seedLayer(layer, count, palette) {
      for (let i=0;i<count;i++) {
        const color = palette[Math.floor(Math.random()*palette.length)];
        layer.appendChild(makePetal(color));
      }
      setInterval(()=>{
        const color = palette[Math.floor(Math.random()*palette.length)];
        const p = makePetal(color);
        layer.appendChild(p);
        setTimeout(()=>{ p.remove(); }, 24000);
      }, 1200);
    }

    seedLayer(FAR, 12, ['#ffe4e6','#fecdd3']);
    seedLayer(MID, 10, ['#fecdd3','#fda4af']);
    seedLayer(NEAR, 8, ['#fda4af','#fb7185']);


  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'981a759c20004a8a',t:'MTc1ODI5OTM0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
